# JWT

## 为什么要用JWT
想象一下你去餐厅吃饭：
+ 你走进餐厅，服务员问：“您有预约吗？”
+ 你说：“没有，但我带了身份证。”
+ 服务员核对身份证 → 确认你是真实顾客 → 允许你入座。

✅ 这个过程就是 “认证”（Authentication） —— 验证你是谁。

而 “授权”（Authorization） 是：你坐下来后，服务员问：“你想吃牛肉还是鱼？”
你说：“我想吃牛排。”
服务员说：“好的，这是您的牛排。”

👉 所以：
+ 认证：你是谁？（身份验证）
+ 授权：你能做什么？（权限控制）

## JWT是什么
✅ JWT（JSON Web Token）就是一个“数字身份证”，它把你的身份信息和权限信息，加密打包成一个字符串，你拿着它去访问系统，系统就能立刻认出你

## JWT的结构：长什么样
一个 JWT 字符串看起来像这样：
```
eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c
```
它由 三部分组成，用 . 分隔：
```
Header.Payload.Signature
```
我们来拆开看，就像拆一个三明治一样：

**第一层： Header（头部）**  
```
{
  "alg": "HS256",
  "typ": "JWT"
}
```
+ alg：签名算法（比如 HS256，表示用 HmacSHA256 加密）
+ typ：类型，这里是JWT

👉 这部分告诉系统：“我是一个 JWT，用什么算法签的。”

**第二层：Payload（内容）———— 你的身份证信息**  
```
{
  "sub": "1234567890",
  "name": "John Doe",
  "iat": 1516239022
}
```
+ sub（subject）：用户唯一 ID（比如数据库主键）
+ name：用户名
+ iat（issued at）：签发时间（时间戳）

👉 你可以把这里想象成你的“身份证上的个人信息”。

> ⚠️ 注意：虽然 Payload 可以被解码（不是加密！），但不能随意篡改，否则签名会失效。

**第三层：Signature（签名）————你的防伪印章**  
这是最核心的一层！
它是由以下三部分拼起来，再用 密钥（secret key） 做签名：
```
HMACSHA256(
  base64UrlEncode(Header) + "." +
  base64UrlEncode(Payload),
  secret
)
```
👉 就像你身份证上的防伪水印，只有官方有“印章钥匙”，别人伪造不了。

## JWT工作流程（用生活场景类比）
我们用一个 “去银行取钱” 的故事来理解：

🎬 场景：小明去银行取钱
1. 小明走进银行，柜员问：“请出示您的身份证和银行卡。”
2. 小明拿出身份证 + 银行卡 → 柜员核对信息。
3. 核对无误后，柜员给小明一个 “身份令牌”（JWT），上面写着：
   - “持卡人：小明”
   - “卡号：6222 0000 1111 2222”
   - “有效期：2025-12-18 ~ 2025-12-19”
   - “签名：防伪章（只有银行知道）”
4. 小明拿着这个令牌，走向 ATM 机。
5. ATM 机扫了令牌 → 解码 Header + Payload → 然后用 银行的“钥匙” 验证 Signature 是否有效。
6. ✅ 验证通过 → ATM 机确认：“这是真实的小明，有权限取钱！”
7. 小明输入密码 → 成功取钱！

**关键点总结**  
|步骤|说明|
|---|---|
|1️⃣ 登录|用户提交账号密码 → 服务端验证 → 生成 JWT|
|2️⃣ 返回 JWT|服务端把 JWT 返回给前端（通常存进 localStorage）|
|3️⃣ 携带 JWT 请求|后续每次请求，前端在 Authorization 头中带上 JWT|
|4️⃣ 服务端验证|服务端解码 JWT → 验证签名 → 检查有效期 → 确认身份|
|5️⃣ 放行请求|验证通过 → 返回数据；失败 → 返回 401 错误|

## JWT的优点与缺点
|优点|缺点|
|---|---|
|✅无状态：服务端不存session，可水平扩展|❌无法主动注销（除非用黑名单机制）|
|✅自包含：用户信息和权限都在token里|❌一旦泄露，攻击者可长期冒用|
|✅跨域友好：适合前后端分离架构|❌体积比session大（不过可接受）|

## 总结
🎯 JWT 就像一张“电子身份证”，它把你的身份信息加密封装成一个字符串，你带着它去访问系统，系统用“钥匙”验证它是否真实有效
+ JWT不建议存储密码、银行卡号等敏感信息
+ 一定要用HTTPS传输JWT，防止被窃听
+ 设置合理的过期时间（如30min~2h）
