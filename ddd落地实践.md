åœ¨å­¦ä¹ dddå¦‚ä½•è½åœ°å®è·µä¹‹å‰ï¼Œå…ˆäº†è§£ä»€ä¹ˆæ˜¯é™ç•Œä¸Šä¸‹æ–‡ï¼Ÿ

é™ç•Œä¸Šä¸‹æ–‡æ˜¯ DDDç”¨äºæˆ˜ç•¥è®¾è®¡ä¸Šæå‡ºçš„æ¦‚å¿µï¼Œç”¨æ¥ç¡®å®šè¯­ä¹‰æ‰€åœ¨çš„é¢†åŸŸè¾¹ç•Œã€‚  
é™ç•Œå°±æ˜¯ é¢†åŸŸçš„è¾¹ç•Œï¼Œ ä¸Šä¸‹æ–‡æ˜¯ è¯­ä¹‰ç¯å¢ƒã€‚ é€šè¿‡é¢†åŸŸçš„é™ç•Œä¸Šä¸‹æ–‡ï¼Œå¯ä»¥åœ¨ç»Ÿä¸€çš„é¢†åŸŸè¾¹ç•Œå†…ç”¨ç»Ÿä¸€çš„è¯­è¨€è¿›è¡Œäº¤æµã€‚  

å…¶å®šä¹‰ï¼š ç”¨æ¥å°è£…é€šç”¨è¯­è¨€å’Œé¢†åŸŸå¯¹è±¡ï¼Œæä¾›ä¸Šä¸‹æ–‡ç¯å¢ƒï¼Œä¿è¯åœ¨é¢†åŸŸå†…çš„ä¸€äº›æœ¯è¯­ã€ä¸šåŠ¡ç›¸å…³å¯¹è±¡ç­‰ï¼ˆé€šç”¨è¯­è¨€ï¼‰æœ‰ä¸€ä¸ªç¡®åˆ‡çš„å«ä¹‰ï¼Œæ²¡æœ‰äºŒä¹‰æ€§ã€‚  
è¿™ä¸ªè¾¹ç•Œå®šä¹‰äº†æ¨¡å‹çš„é€‚ç”¨èŒƒå›´ï¼Œä½¿å›¢é˜Ÿæˆå‘˜æ˜ç¡®çš„çŸ¥é“ä»€ä¹ˆåº”è¯¥åœ¨æ¨¡å‹ä¸­å®ç°ï¼Œä»€ä¹ˆä¸åº”è¯¥åœ¨æ¨¡å‹ä¸­å®ç°ã€‚ æ¯”å¦‚ å•†å“åœ¨é”€å”®é˜¶æ®µæ˜¯å•†å“ï¼Œè€Œåœ¨è¿è¾“é˜¶æ®µæ˜¯è´§ç‰©ã€‚åŒä¸€ä¸ªä¸œè¥¿ï¼Œç”±äºä¸šåŠ¡é¢†åŸŸä¸åŒï¼Œèµ‹äºˆè¿™äº›æœ¯è¯­ä¸åŒçš„å«ä¹‰å’ŒèŒè´£è¾¹ç•Œï¼Œè¿™ä¸ªè¾¹ç•Œå°±æ˜¯å¾®æœåŠ¡è®¾è®¡çš„è¾¹ç•Œã€‚é¢†åŸŸè¾¹ç•Œå°±æ˜¯é€šè¿‡é™ç•Œä¸Šä¸‹æ–‡æ¥å®šä¹‰çš„ã€‚

# DDDæ¦‚å¿µ
## ç»Ÿä¸€è¯­è¨€å’Œæ¦‚å¿µæ˜ç¡®ï¼ŒåŒä¸€ä¸ªå›¢é˜Ÿï¼ŒåŒä¸€ç§è¯­è¨€
DDDä¸­æœ€é‡è¦çš„æ˜¯è¦æ˜ç¡®æ¦‚å¿µã€‚ åƒåšè¯­æ–‡é¢˜ä¸€æ ·ï¼Œæ·±ç©¶æ¯ä¸ªåè¯çš„å«ä¹‰ã€‚

### æ¦‚å¿µä¸æ˜ç¡®çš„å¸¸è§æƒ…å†µ
+ æ¦‚å¿µè¿‡å¤§ã€å®½æ³›ã€æ¶µç›–äº†å¤šå±‚å«ä¹‰
+ æ¦‚å¿µåœ¨ä¸åŒä¸Šä¸‹æ–‡å«ä¹‰ä¸åŒ
+ ç›¸ä¼¼åç§°æ··ç”¨ï¼Œæ¯”å¦‚æ··ç”¨åŒä¹‰è¯ï¼Œä½†å®é™…æ„ä¹‰æ˜¯æœ‰å·®åˆ«çš„
+ åŒä¸€ä¸ªæ¦‚å¿µï¼Œéšæ„çš„ä½¿ç”¨å¤šä¸ªåç§°

### æ˜ç¡®æ¦‚å¿µçš„å»ºè®®
+ æ¦‚å¿µæ˜¯åè¯
+ æ¦‚å¿µæ˜¯ç¬¦åˆè¡Œä¸šæ ‡å‡†çš„
+ æ¦‚å¿µæ˜¯æœ‰è¾¹ç•Œçš„ï¼Œæœ‰å…¸å‹æ¡ˆä¾‹
+ æ¦‚å¿µæ˜¯åˆ†ä¸Šä¸‹æ–‡è¯­å¢ƒçš„
+ åŒä¸€ä¸ªæ¦‚å¿µï¼Œåªæœ‰ä¸€ä¸ªåè¯æ ‡è¡¨ç¤º
+ å‘½åç›´æ¥ï¼Œä¸äº§ç”Ÿæ­§ä¹‰

### æ¦‚å¿µå¯èƒ½æ··ç”¨çš„ä¸¾ä¾‹â€”â€”ç”¨æˆ·ã€å®¢æˆ·ã€è´¦æˆ·ã€ç§Ÿæˆ·çš„åŒºåˆ«
```mermaid
graph TD

A[å®¢æˆ·]
B[ç§Ÿæˆ·]
C[è´¦æˆ·]
D[ç™»å½•æ–¹å¼]
E[åŠŸèƒ½æƒé™]
F[ç”¨æˆ·]
A-->|è®¢è´­å¼€é€šåæ‹¥æœ‰ 1..N|B---->|N..N|C---->|1..N|D
B-->|æ‹¥æœ‰ N..N|E
F--->|æ³¨å†Œå¼€é€šåæ‹¥æœ‰ 1..1|C
C--->|æ‹¥æœ‰æˆæƒ N..N|E
```

## é¢†åŸŸæ¨¡å‹æ˜¯æŠ€æœ¯æ— å…³çš„ï¼Œæ˜¯é—®é¢˜çš„æ ¸å¿ƒ
é¢†åŸŸæ¨¡å‹<â€”â€”é¢†åŸŸæœåŠ¡<â€”â€”åº”ç”¨æœåŠ¡<â€”â€”ç”¨æˆ·ç•Œé¢ ï¼ˆç®­å¤´æŒ‡å‘ä¾èµ–æ–¹å‘ï¼‰
åŸºç¡€è®¾æ–½ä¾èµ–  æ¡†æ¶ã€DBã€å¤–éƒ¨æœåŠ¡

## å»ºæ¨¡çš„æ–¹å¼
ç†è§£é¢†åŸŸâ€”â€”>æ˜æ™°æ¦‚å¿µâ€”â€”>å»ºç«‹æ¦‚å¿µä¹‹é—´çš„å…³ç³»
### äº‹ä»¶é£æš´
+ å‘½ä»¤
+ å®ä½“
+ äº‹ä»¶
ä¸¾ä¾‹ï¼š å›´ç»•å•†å“ï¼› å•†å“ï¼ˆå®ä½“ï¼‰ã€åˆ›å»ºå•†å“ï¼ˆå‘½ä»¤ï¼‰ã€å•†å“å·²åˆ›å»ºï¼ˆäº‹ä»¶ï¼‰ã€ä¸Šæ¶å•†å“ï¼ˆå‘½ä»¤ï¼‰ã€å•†å“å·²ä¸Šæ¶ï¼ˆäº‹ä»¶ï¼‰

### å››è‰²å»ºæ¨¡æ³•
+ monent-interval
+ è§’è‰²
+ äººâ€”â€”äº‹â€”â€”ç‰©
+ æè¿°

### ç”¨æˆ·æ•…äº‹åœ°å›¾
+ è§’è‰²ï¼š å¦‚ ä¸Šç­æ—ã€çˆ¶äº²ã€å·¥ç¨‹å¸ˆ
+ æ´»åŠ¨ï¼šæ´»åŠ¨åˆ†è§£
+ ä»»åŠ¡ï¼šä»»åŠ¡åˆ†è§£

### å»ºæ¨¡==åˆ†æè¯­è¨€
å¼ ä¸‰å»ä¹°æˆ¿ï¼Œä¸­ä»‹è®©ç•™ä¸ªç”µè¯ï¼Œæœ‰åˆé€‚çš„æˆ¿æºäº†ï¼Œä¼šé€šçŸ¥ä»–è¿‡æ¥çœ‹æˆ¿

åˆ†æè¿™ä¸ªåœºæ™¯
+ ä¹°æˆ¿è€…ï¼šå¼ ä¸‰
+ æˆ¿äº§ä¸­ä»‹ï¼š ä¸­ä»‹å…¬å¸ã€ä¸­ä»‹å‘˜å·¥
+ ç”µè¯ï¼š è”ç³»æ–¹å¼
+ å·¥ä½œæœºä¼š
+ çœ‹æˆ¿ï¼šé¢„çº¦çœ‹æˆ¿

ä¸­ä»‹å…¬å¸â€”â€”ï¼ˆ1..*ï¼‰â€”â€”ä¸­ä»‹å‘˜å·¥â€”â€”ï¼ˆ1..æœåŠ¡..*ï¼‰â€”â€”ä¹°æˆ¿è€…â€”â€”ï¼ˆ1..é¢„çº¦..*ï¼‰â€”â€”>çœ‹æˆ¿<â€”â€”ï¼ˆ*..äº§ç”Ÿ..1ï¼‰â€”â€”æˆ¿æº
å…¶å®è¿™ä¸ªåœºæ™¯ä¸­è¿˜åŒ…å«æˆ¿ä¸»ï¼Œæˆ¿ä¸»ä¹Ÿå¯ä»¥å‘å¸ƒæˆ¿æºï¼Œä¹Ÿå¯ä»¥ç”±ä¸­ä»‹å½•å…¥æˆ¿æºã€‚
ä¸­ä»‹å’Œæˆ¿ä¸»ä¹‹é—´å­˜åœ¨å…³è”å…³ç³»ã€‚

### å®ä½“vs.å€¼å¯¹è±¡
å…ˆåˆ†æè¯†åˆ«å®ä½“å’Œå€¼å¯¹è±¡æ„å»ºé¢†åŸŸæ¨¡å‹ï¼Œå†æ ¹æ®é¢†åŸŸæ¨¡å‹å°†å…¶è½¬ä¸ºæ•°æ®æ¨¡å‹ã€‚

**å®ä½“**  
å…·æœ‰å”¯ä¸€æ ‡è¯†ï¼ˆIDï¼‰ï¼Œä¸”çŠ¶æ€ä¼šéšä¸šåŠ¡å˜åŒ–çš„å¯¹è±¡ã€‚ä¾‹å¦‚ï¼Œè®¢å•ä¸Šä¸‹æ–‡çš„ â€œè®¢å•â€ï¼ˆæœ‰å”¯ä¸€è®¢å• IDï¼ŒçŠ¶æ€ä¼šä»ã€å¾…æ”¯ä»˜ã€‘å˜ä¸ºã€å·²æ”¯ä»˜ã€‘ï¼‰ã€ç”¨æˆ·ä¸Šä¸‹æ–‡çš„ â€œç”¨æˆ·â€ï¼ˆæœ‰å”¯ä¸€ç”¨æˆ· IDï¼Œä¿¡æ¯ä¼šæ›´æ–°ï¼‰ã€‚å®ä½“çš„æ ¸å¿ƒæ˜¯ â€œçŠ¶æ€ä¸è¡Œä¸ºçš„å°è£…â€â€”â€” ä¾‹å¦‚ï¼Œè®¢å•å®ä½“ä¸­åº”åŒ…å« â€œå–æ¶ˆè®¢å•â€ çš„æ–¹æ³•ï¼ˆåˆ¤æ–­å½“å‰çŠ¶æ€æ˜¯å¦å¯å–æ¶ˆï¼Œè‹¥å¯å–æ¶ˆåˆ™æ›´æ–°çŠ¶æ€å¹¶è§¦å‘é€€æ¬¾äº‹ä»¶ï¼‰ï¼Œè€Œéå°† â€œå–æ¶ˆé€»è¾‘â€ æ”¾åœ¨è®¢å•æœåŠ¡çš„æ¥å£ä¸­

**å€¼å¯¹è±¡**  
æ— å”¯ä¸€æ ‡è¯†ï¼Œä»…é€šè¿‡å±æ€§å€¼åˆ¤æ–­ç›¸ç­‰æ€§ï¼Œä¸”çŠ¶æ€ä¸å¯å˜çš„å¯¹è±¡ã€‚ä¾‹å¦‚ï¼Œè®¢å•ä¸Šä¸‹æ–‡çš„ â€œæ”¶è´§åœ°å€â€ï¼ˆåŒ…å«çœã€å¸‚ã€åŒºã€è¯¦ç»†åœ°å€ï¼Œåªè¦å±æ€§å€¼ç›¸åŒï¼Œå°±æ˜¯åŒä¸€ä¸ªåœ°å€ï¼Œæ— éœ€ IDï¼‰ã€æ”¯ä»˜ä¸Šä¸‹æ–‡çš„ â€œé‡‘é¢â€ï¼ˆåŒ…å«æ•°å€¼å’Œè´§å¸ç±»å‹ï¼Œå¦‚ 100 å…ƒã€20 ç¾å…ƒï¼Œä¸å¯ä¿®æ”¹ï¼Œä¿®æ”¹æ—¶éœ€åˆ›å»ºæ–°çš„é‡‘é¢å¯¹è±¡ï¼‰ã€‚å€¼å¯¹è±¡çš„ä½œç”¨æ˜¯ç®€åŒ–å®ä½“è®¾è®¡ â€”â€” è‹¥å°†æ”¶è´§åœ°å€çš„å±æ€§ï¼ˆçœã€å¸‚ã€åŒºï¼‰ç›´æ¥æ”¾åœ¨è®¢å•å®ä½“ä¸­ï¼Œä¼šå¯¼è‡´è®¢å•å®ä½“å±æ€§å†—ä½™ï¼Œè€Œç”¨å€¼å¯¹è±¡å°è£…åï¼Œè®¢å•å®ä½“åªéœ€å…³è”ä¸€ä¸ª â€œæ”¶è´§åœ°å€â€ å€¼å¯¹è±¡

æ¯”å¦‚ï¼š
å°† ã€é¢†åŸŸæ¨¡å‹ã€‘ç”¨æˆ·ï¼ˆIDã€å§“åã€å¹´é¾„ã€æ€§åˆ«ã€åœ°å€ï¼‰ï¼Œå…¶ä¸­åœ°å€å¼•ç”¨ åœ°å€å€¼å¯¹è±¡ï¼ˆçœã€å¸‚ã€å¿ã€è¡—é“ï¼‰
å†å°†ã€é¢†åŸŸæ¨¡å‹ã€‘è½¬ä¸ºã€æ•°æ®æ¨¡å‹ã€‘ã€‚ å¯ä»¥ç”¨ä¸€å¼ æ•°æ®åº“è¡¨ç¤ºæ•°æ®æ¨¡å‹ï¼› ç”¨æˆ·ï¼ˆIDã€å§“åã€å¹´é¾„ã€æ€§åˆ«ã€çœã€å¸‚ã€å¿ã€è¡—é“ï¼‰ï¼Œå…¶ä¸­ï¼ˆçœã€å¸‚ã€å¿ã€è¡—é“ï¼‰å±äºåœ°å€ç›¸å…³çš„å±æ€§ã€‚è¿™éƒ¨åˆ†å±æ€§ä¹Ÿå¯ä»¥æ ¹æ®å®é™…æƒ…å†µå•ç‹¬æˆè¡¨ã€‚

### èšåˆå’Œèšåˆæ ¹
+ èšåˆ èƒ½è®© å®ä½“å’Œå€¼å¯¹è±¡ååŒå·¥ä½œï¼Œå®ƒæ˜¯ç”¨æ¥ç¡®ä¿è¿™äº›é¢†åŸŸå¯¹è±¡åœ¨å®ç°å…±åŒçš„ä¸šåŠ¡é€»è¾‘æ—¶ï¼Œèƒ½ä¿è¯æ•°æ®ä¸€è‡´æ€§ã€‚
+ èšåˆ å°±æ˜¯ç”± ä¸šåŠ¡å’Œé€»è¾‘ç´§å¯†å…³è”çš„å®ä½“å’Œå€¼å¯¹è±¡ç»„åˆè€Œæˆçš„ã€‚ èšåˆæ˜¯æ•°æ®ä¿®æ”¹å’ŒæŒä¹…åŒ–çš„åŸºæœ¬å•å…ƒï¼Œæ¯ä¸€ä¸ªèšåˆå¯¹åº”ä¸€ä¸ªä»“å‚¨ï¼Œå®ç°æ•°æ®çš„æŒä¹…åŒ–ã€‚
+ èšåˆ æœ‰ä¸€ä¸ªèšåˆæ ¹å’Œä¸Šä¸‹æ–‡è¾¹ç•Œï¼Œè¿™ä¸ªè¾¹ç•Œæ ¹æ®ä¸šåŠ¡å•ä¸€èŒè´£å’Œé«˜å†…èšåŸåˆ™ï¼Œå®šä¹‰äº†èšåˆå†…éƒ¨åº”è¯¥åŒ…å«å“ªäº›å®ä½“å’Œå€¼å¯¹è±¡ï¼Œè€Œèšåˆä¹‹é—´çš„è¾¹ç•Œæ˜¯æ¾è€¦åˆçš„ã€‚

**èšåˆæ ¹**
+ å¦‚æœæŠŠèšåˆæ¯”ä½œç»„ç»‡ï¼Œèšåˆæ ¹å°±æ˜¯è¿™ä¸ªç»„ç»‡çš„è´Ÿè´£äºº
+ èšåˆæ ¹ä½œä¸ºå®ä½“æœ¬èº«ï¼Œæ‹¥æœ‰å®ä½“çš„å±æ€§å’Œä¸šåŠ¡è¡Œä¸ºï¼Œå®ç°è‡ªèº«çš„ä¸šåŠ¡é€»è¾‘
+ èšåˆæ ¹ä½œä¸ºèšåˆçš„ç®¡ç†è€…ï¼Œåœ¨èšåˆå†…éƒ¨è´Ÿè´£åè°ƒå®ä½“å’Œå€¼å¯¹è±¡æŒ‰ç…§å›ºå®šçš„ä¸šåŠ¡è§„åˆ™ååŒå®Œæˆå…±åŒçš„ä¸šåŠ¡é€»è¾‘
+ æœ€ååœ¨èšåˆä¹‹é—´ï¼Œå®ƒè¿˜æ˜¯èšåˆå¯¹å¤–çš„æ¥å£äººï¼Œä»¥èšåˆæ ¹IDå…³è”çš„æ–¹å¼æ¥å—å¤–éƒ¨ä»»åŠ¡å’Œè¯·æ±‚ï¼Œåœ¨ä¸Šä¸‹æ–‡å†…å®ç°èšåˆä¹‹é—´çš„ä¸šåŠ¡ååŒã€‚
+ èšåˆä¹‹é—´é€šè¿‡èšåˆæ ¹IDå…³è”å¼•ç”¨ï¼Œå¦‚æœéœ€è¦è®¿é—®å…¶ä»–èšåˆçš„å®ä½“ï¼Œå°±å…ˆè®¿é—®èšåˆæ ¹ï¼Œåœ¨å¯¼èˆªåˆ°èšåˆå†…éƒ¨å®ä½“ï¼Œå¤–éƒ¨å¯¹è±¡ä¸èƒ½ç›´æ¥è®¿é—®èšåˆå†…å®ä½“ã€‚

### èšåˆè®¾è®¡çš„æ­¥éª¤ã€æ–¹æ³•
+ äº‹ä»¶é£æš´æ‰¾å‡ºå®ä½“å’Œå€¼å¯¹è±¡ï¼ˆå“ªäº›å±äºå®ä½“ã€å“ªäº›å±äºå€¼å¯¹è±¡ï¼Œå…ˆåˆ—å‡ºæ¥ï¼‰
+ æ‰¾å‡ºèšåˆæ ¹ï¼ˆå½’ç±»ã€ç¡®è®¤èšåˆæ ¹ï¼‰
+ æ‰¾å‡ºèšåˆ
+ å¯¹è±¡å¼•ç”¨å’Œä¾èµ–æ¨¡å‹

### é¢†åŸŸæœåŠ¡
å°è£…è·¨å®ä½“ / å€¼å¯¹è±¡çš„ä¸šåŠ¡é€»è¾‘ï¼Œæ— æ³•å½’å±åˆ°å•ä¸ªå®ä½“æˆ–å€¼å¯¹è±¡ã€‚ä¾‹å¦‚ï¼Œè®¢å•ä¸Šä¸‹æ–‡çš„ â€œè®¡ç®—è®¢å•æ€»é‡‘é¢â€ æœåŠ¡ â€”â€” æ€»é‡‘é¢ = å•†å“é‡‘é¢ + è¿è´¹ - æŠ˜æ‰£ï¼Œæ¶‰åŠ â€œè®¢å•é¡¹â€ï¼ˆå®ä½“ï¼‰ã€â€œè¿è´¹è§„åˆ™â€ï¼ˆå€¼å¯¹è±¡ï¼‰ã€â€œæŠ˜æ‰£åˆ¸â€ï¼ˆå€¼å¯¹è±¡ï¼‰ï¼Œéœ€é€šè¿‡é¢†åŸŸæœåŠ¡åè°ƒå¤šä¸ªå¯¹è±¡å®Œæˆè®¡ç®—

### é¢†åŸŸäº‹ä»¶
è®°å½•é¢†åŸŸå†…å‘ç”Ÿçš„é‡è¦äº‹ä»¶ï¼Œç”¨äºå®ç°è·¨é¢†åŸŸ / è·¨ä¸Šä¸‹æ–‡çš„å¼‚æ­¥é€šä¿¡ã€‚ä¹Ÿä¸»è¦ç”¨äºè½¯ä»¶ä¸­å„ä¸ªç»„ä»¶ã€æ¨¡å—ã€å­ç³»ç»Ÿç”šè‡³ç¬¬ä¸‰æ–¹ç³»ç»Ÿä¹‹é—´çš„æ•°æ®åŒæ­¥ä¸é›†æˆã€‚
ä¾‹å¦‚ï¼Œè®¢å•ä¸Šä¸‹æ–‡çš„ â€œè®¢å•æ”¯ä»˜æˆåŠŸäº‹ä»¶â€ï¼Œæ”¯ä»˜æˆåŠŸåï¼Œè®¢å•ä¸Šä¸‹æ–‡å‘å¸ƒè¯¥äº‹ä»¶ï¼Œåº“å­˜ä¸Šä¸‹æ–‡è®¢é˜…è¯¥äº‹ä»¶å¹¶æ‰£å‡åº“å­˜ï¼Œç‰©æµä¸Šä¸‹æ–‡è®¢é˜…è¯¥äº‹ä»¶å¹¶åˆ›å»ºé…é€å•ã€‚é¢†åŸŸäº‹ä»¶çš„æ ¸å¿ƒä»·å€¼æ˜¯è§£è€¦è·¨é¢†åŸŸä¾èµ– â€”â€” è®¢å•ä¸Šä¸‹æ–‡æ— éœ€ç›´æ¥è°ƒç”¨åº“å­˜å’Œç‰©æµæœåŠ¡ï¼Œåªéœ€å‘å¸ƒäº‹ä»¶ï¼Œå…¶ä»–ä¸Šä¸‹æ–‡æŒ‰éœ€è®¢é˜…ã€‚
é¢†åŸŸäº‹ä»¶çš„å‘½åä¸€èˆ¬çº¦å®šæ˜¯  XXXå·²ç»XXXçš„å½¢å¼ï¼Œå®é™…å»ºæ¨¡æ—¶ï¼Œé€šå¸¸å…ˆå»ºç«‹ä¸€ä¸ªå…¬å…±åŸºç±» DomainEventï¼Œå…¶ä»–äº‹ä»¶ç±»ç»§æ‰¿è‡ªè¯¥åŸºç±»ã€‚ å¦‚ OrderPaidEventã€UserCreatedEventç­‰ã€‚

```python
class DomainEvent:
    def __init__(self, type, status="CREATED"):
        self.event_id = gen_snow_fake_id()
        self.type = type  # äº‹ä»¶ç±»å‹ DomainEventType
        self.status = status  # äº‹ä»¶çŠ¶æ€  CREATEDã€PUBLISH_SUCCESSã€PUBLISH_FAILED
        self.create_at = now()  # äº‹ä»¶å‘ç”Ÿæ—¶é—´
```

## é¢†åŸŸé©±åŠ¨è®¾è®¡ï¼ˆæ¶æ„åˆ†å±‚ï¼‰
ç”¨æˆ·æ¥å£å±‚â€”â€”>åº”ç”¨å±‚â€”â€”>é¢†åŸŸå±‚â€”â€”>åŸºç¡€è®¾æ–½å±‚ã€‚
+ æ¥å…¥å±‚ï¼šåªè´Ÿè´£ç³»ç»Ÿçš„è¾“å…¥å’Œè¾“å‡ºï¼Œåªå…³å¿ƒæ²Ÿé€šåè®®ï¼Œæ•°æ®æ ¼å¼ï¼Œè€Œä¸å…³å¿ƒæ•°æ®å†…å®¹ã€ä¸šåŠ¡ç›¸å…³çš„æ•°æ®æ ¡éªŒï¼Œä½†æ— ä¸šåŠ¡é€»è¾‘ã€‚
+ åº”ç”¨å±‚ï¼šåªè´Ÿè´£ç»„ç»‡ä¸šåŠ¡åœºæ™¯ï¼Œç¼–æ’ä¸šåŠ¡ï¼Œéš”ç¦»åœºæ™¯å¯¹é¢†åŸŸå±‚çš„å·®å¼‚ã€‚å…³å¿ƒå¤„ç†å®Œä¸€ä¸ªå®Œæ•´çš„ä¸šåŠ¡ï¼Œä¸å…³å¿ƒå…·ä½“å†…éƒ¨ä¸šåŠ¡é€»è¾‘ã€‚ä¸å…³å¿ƒè¯·æ±‚ä»ä½•å¤„æ¥ã€å…³å¿ƒè°æ¥ã€åšä»€ä¹ˆã€æœ‰æ²¡æœ‰æƒé™åšï¼›æ­¤å±‚å¯ä»¥åŒ…å«ç®€å•æŸ¥è¯¢é€»è¾‘ï¼Œä½†æ ¸å¿ƒä¸šåŠ¡é€»è¾‘å¿…é¡»ä¸‹æ²‰åˆ°é¢†åŸŸå±‚
+ é¢†åŸŸå±‚ï¼šå®ç°å…·ä½“çš„ä¸šåŠ¡é€»è¾‘ã€è§„åˆ™ï¼Œä¸ºåº”ç”¨å±‚æä¾›æ— å·®åˆ«æœåŠ¡èƒ½åŠ›ã€‚ä¸šåŠ¡åœ¨è¿™é‡Œç»„è£…ã€‚ä»“å‚¨ï¼ˆèµ„æºåº“ï¼‰æ¥å£åœ¨æ­¤å±‚å®šä¹‰ã€‚ä¸å…³å¿ƒåœºæ™¯ï¼Œå…³å¿ƒæ¨¡å‹å®Œæ•´æ€§å’Œä¸šåŠ¡è§„åˆ™ã€‚å¼ºä¸€è‡´æ€§äº‹åŠ¡åœ¨é¢†åŸŸå±‚å¤„ç†ï¼Œé¢†åŸŸå±‚åšä¸šåŠ¡è§„åˆ™æ ¡éªŒï¼Œæ•°æ®æƒé™æ§åˆ¶ï¼Œè·¨ä¸Šä¸‹æ–‡ä½¿ç”¨å€¼å¯¹è±¡åšå¿…è¦çš„æ•°æ®å†—ä½™ã€‚
+ åŸºç¡€è®¾æ–½å±‚ï¼šä»“å‚¨ï¼ˆèµ„æºåº“ï¼‰å®ç°å±‚+POæŒä¹…åŒ–å±‚ã€‚æä¾›å…·ä½“çš„æŠ€æœ¯å®ç°ï¼Œæ¯”å¦‚å­˜å‚¨ã€æ¶ˆæ¯ä¼ é€’ã€é€šçŸ¥ï¼ŒåŸºç¡€è®¾æ–½å¯¹ä¸šåŠ¡ä¿æŒé€æ˜ã€‚åŸºç¡€è®¾æ–½çš„æƒé™ç”±é…ç½®åˆ°åº”ç”¨çš„å‡­è¯æ§åˆ¶ã€‚ æ¯”å¦‚ æ•°æ®åº“ã€å¯¹è±¡å­˜å‚¨çš„å‡­è¯ï¼ŒæŠ€æœ¯è®¾æ–½å±‚ä¸æ¶‰åŠç”¨æˆ·çš„æƒé™ã€‚
+ æœ€æ ¸å¿ƒæ˜¯é¢†åŸŸå±‚ï¼Œæ‰¿è½½é¢†åŸŸçŸ¥è¯†ï¼ˆä¸šåŠ¡è§„åˆ™ï¼Œä¸šåŠ¡é€»è¾‘ï¼‰
+ ç†æƒ³çŠ¶æ€ä¸‹ï¼Œé¢†åŸŸå±‚ä¸ä¾èµ–ä»»ä½•å±‚ã€‚æŒä¹…åŒ–ä¹Ÿä¸åœ¨é¢†åŸŸå±‚æ“ä½œï¼Œå…·ä½“å®ç°ä¸ºåœ¨é¢†åŸŸå±‚å®šä¹‰ repositoryæ¥å£ï¼Œåœ¨åŸºç¡€è®¾æ–½å±‚æ˜¯è¢­è­¦æ¡ˆï¼Œå¹¶åœ¨ åº”ç”¨å±‚è°ƒç”¨ã€‚

## æ¶æ„åˆ†å±‚ç¤ºä¾‹
<img width="351" height="793" alt="image" src="https://github.com/user-attachments/assets/90409c32-fa92-425e-84e4-2dac9e6d0bc4" />

## æœåŠ¡è°ƒç”¨
### åŸŸå†…è°ƒç”¨
é¢†åŸŸå†…è°ƒç”¨ï¼Œéšä¾¿è°ƒç”¨ã€‚è‡³äºå®ç°ï¼Œå¯ä»¥ç”±ä¸€ä¸ªæ ¸å¿ƒåŸŸçš„ä»“å‚¨å®ç°å±‚ï¼ˆç¬¬å››å±‚ï¼‰å»å®ç°å¤šä¸ªRepositoryæ¥å£ã€‚ï¼ˆæ¯”å¦‚è¿™é‡ŒAæ˜¯æ ¸å¿ƒåŸŸçš„å®ä½“åï¼ŒBæ˜¯æ”¯æ’‘åŸŸã€é€šç”¨åŸŸç­‰ï¼‰

<img width="339" height="237" alt="image" src="https://github.com/user-attachments/assets/4e79519d-db5b-49f0-a452-8d4587cd64c6" />

### è·¨åŸŸè°ƒç”¨
+ åŒä¸Šä¸‹æ–‡è·¨åŸŸï¼šACLå±‚->Adapteré€‚é…å™¨å±‚â†’è°ƒç”¨å…¶å®ƒåŸŸçš„repositoryã€‚--->ä¸å¾—å·²æ‰ä½¿ç”¨ï¼Œä¸æ¨èä½¿ç”¨ã€‚
  - ä½¿ç”¨é¢†åŸŸäº‹ä»¶ eventbusæ¥åšè§£è€¦ï¼ˆæ¨èï¼‰
  - è€ƒè™‘æ˜¯å¦æœ‰å¯èƒ½åˆå¹¶ä¸ºä¸€ä¸ªé¢†åŸŸ.

+ è·¨ä¸Šä¸‹æ–‡ï¼ˆè‚¯å®šè·¨åŸŸï¼‰ï¼šACLå±‚->Adapteré€‚é…å™¨å±‚->feignè°ƒç”¨
<img width="561" height="514" alt="image" src="https://github.com/user-attachments/assets/31db6e15-a6fd-44bf-8aed-fc35d57b1a99" />

## åŒ…ç»“æ„ç¤ºä¾‹
<img width="433" height="325" alt="image" src="https://github.com/user-attachments/assets/db2721db-2637-4ba6-b8d8-9de159e9e94e" />

## é˜²è…å±‚&ä¾èµ–å€’ç½®

# DDDåœ¨Djangoé¡¹ç›®ä¸­çš„å®è·µ
åœ¨dddè½åœ°djangoé¡¹ç›®å‰ï¼Œå…ˆäº†è§£ä¸‹åˆ†å±‚è®¾è®¡æ¨¡å¼ã€‚å¸¸è§çš„ä¸»è¦æœ‰ä¸¤ç§åˆ†å±‚è®¾è®¡æ¨¡å¼ï¼ˆMVTï¼‰å’Œï¼ˆMVCï¼‰ï¼Œdjangoé‡‡ç”¨çš„æ˜¯MVTæ¨¡å¼ï¼Œä¹Ÿå°±æ˜¯ Modelã€Viewã€Templateï¼Œä½†å…¶å®åœ¨å¦‚ä»Šå‰åç«¯åˆ†ç¦»é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬å¾ˆå°‘ç”¨åˆ°djangoçš„templateï¼Œæˆ‘ä»¬åªç”¨åˆ°äº†MVï¼Œé‚£Tå»å“ªäº†ï¼Ÿ
Tå°±æ˜¯å‰ç«¯çš„vueã€reactã€ç­‰å‰ç«¯æ¡†æ¶ï¼Œå‰åç«¯é€šè¿‡apiæ¥å£äº¤äº’ã€‚ é‚£Cï¼ˆæ§åˆ¶å™¨ï¼‰æ˜¯ä»€ä¹ˆï¼ŸCå°±æ˜¯Djangoæ¡†æ¶æœ¬èº«ï¼Œ å®ƒé€šè¿‡é…ç½®çš„è·¯ç”±å°†è¯·æ±‚åˆ†å‘ç»™åŒ¹é…çš„è§†å›¾å¤„ç†ã€‚
```
@startuml
package "Djangoæ¡†æ¶" {
    component [è·¯ç”±]  as Router
    [è§†å›¾] as View
    [æ¨¡æ¿] as Template
    [æ¨¡å‹] as Model
    [Djangoä¸­é—´ä»¶] as MiddleWare
}

'cloud æœåŠ¡å™¨ as Server
'actor ç”¨æˆ· as User
'component æµè§ˆå™¨ as Browser
'User .-> Browser: è®¿é—®æµè§ˆå™¨
'Browser .-> Server: http/httpsè¯·æ±‚
'Server <-.-> "Djangoæ¡†æ¶"

Router .-> MiddleWare: è·¯ç”±åŒ¹é…
MiddleWare .-> View: ä¸­é—´ä»¶é¢„å¤„ç†
View -.-> Model: ä¸šåŠ¡é€»è¾‘ã€æ¨¡å‹äº¤äº’
Model -.-> View: è¿”å›æ•°æ®
View -.-> Template: æ•°æ®åµŒå…¥ï¼Œè§†å›¾å‡½æ•°å°†å¤„ç†åçš„æ•°æ®ä¼ é€’ç»™æ¨¡æ¿
Template -.-> View: æ¨¡æ¿å¼•æ“æ¸²æŸ“æˆæœ€ç»ˆçš„HTMLå†…å®¹
View .-> MiddleWare: ä¸­é—´ä»¶åå¤„ç†
@enduml
```

## MVCåˆ†å±‚æ¨¡å¼
|åç§°|åŠŸèƒ½|
|---|---|
|Model|è´Ÿè´£å’Œæ•°æ®ç›¸å…³çš„é€»è¾‘ï¼Œæ•°æ®åº“è¡¨æ“ä½œç›¸å…³|
|View|è´Ÿè´£æ•°æ®å±•ç¤ºï¼Œå°†ä»modelä¸­æˆ–è€…ç”¨æˆ·å¤„è·å–çš„æ•°æ®è¿›è¡Œå±•ç¤ºï¼Œåœ¨å¾ªåºMVCè®¾è®¡æ¨¡å¼æ¡†æ¶å¼€å‘çš„webé¡¹ç›®ä¸­ï¼Œæ‰€æœ‰é€šè¿‡æµè§ˆå™¨å‘ç”¨æˆ·å±•ç¤ºçš„åŠŸèƒ½éƒ½ç”± è§†å›¾æ¨¡å—å®ç°|
|Controller|è´Ÿè´£æ§åˆ¶æ•°æ®æµå‘ä»¥åŠè§†å›¾å’Œæ¨¡å‹ä¹‹é—´çš„äº¤äº’ã€‚ æ§åˆ¶å™¨ä¼šåŸºäºè¯·æ±‚ï¼Œç”±æ¨¡å‹ååŠ©ä»æ•°æ®åº“ä¸­è·å–æ•°æ®ï¼Œç„¶åé€šè¿‡è§†å›¾å‘ˆç°|

## MVTåˆ†å±‚æ¨¡å¼
|åç§°|åŠŸèƒ½|
|---|---|
|Model|è´Ÿè´£å’Œæ•°æ®ç›¸å…³çš„é€»è¾‘ï¼Œæ•°æ®åº“è¡¨æ“ä½œç›¸å…³|
|View|ä¸»è¦ç”¨äºæ‰§è¡Œä¸šåŠ¡é€»è¾‘ï¼Œä»æ¨¡å‹è·å–æ•°æ®ï¼Œå°†æ•°æ®ç»™åˆ°ç‰¹å®šæ¨¡æ¿è¿›è¡Œæ¸²æŸ“åå‘ˆç°ç»™ç”¨æˆ·|
|Template|å¯è§†ä¸ºè¡¨ç¤ºå±‚ï¼Œä¸»è¦æ˜¯ç”¨æˆ·ç•Œé¢ç›¸å…³ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬æ‰€è¯´çš„å‰ç«¯|

å¦‚æœæ‹¿MVCåˆ†å±‚æ¨¡å¼å’ŒMVTæ‰¾å¯¹åº”å…³ç³»ï¼Œå¯ä»¥å°†MVCæ¨¡å¼ä¸­çš„ æ§åˆ¶å™¨ç†è§£ä¸º MVTæ¨¡å¼ä¸­çš„è§†å›¾ï¼Œ å°†MVCæ¨¡å¼ä¸­çš„è§†å›¾ç†è§£ä¸ºMVTæ¨¡å¼ä¸­çš„æ¨¡æ¿ã€‚

## MVTå’ŒMVCçš„åŒºåˆ«ï¼Ÿ
MVCå’ŒMVTä¸¤ç§æ¨¡å¼çš„ä¸»è¦åŒºåˆ«åœ¨äºï¼šåœ¨MVCæ¨¡å¼ä¸­ï¼Œå¼€å‘è€…éœ€è¦ç¼–å†™æ‰€æœ‰å’Œæ§åˆ¶å™¨ç›¸å…³çš„ä»£ç ï¼Œä½†æ˜¯åœ¨MVTæ¨¡å¼ä¸­ï¼Œæ¡†æ¶æœ¬èº«å®Œæˆäº†æ§åˆ¶å™¨ç›¸å…³åŠŸèƒ½
åœ¨ç»å…¸çš„MVCæ¨¡å¼ä¸‹ï¼Œå½“ç”¨æˆ·é€šè¿‡æµè§ˆå™¨å‘èµ·ä¸€ä¸ªè¯·æ±‚åï¼Œå°†è§¦å‘æ§åˆ¶å™¨ä¸­çš„ä¸€ä¸ªåŠŸèƒ½è°ƒç”¨ï¼Œç„¶åæ§åˆ¶å™¨è¦ä¹ˆå‘Šè¯‰æ¨¡å‹ä¿®æ”¹æ•°æ®åº“å¹¶æ›´æ–°è§†å›¾ï¼Œè¦ä¹ˆåŸºäºæ¨¡å‹è¿”å›ä¸€ä¸ªæ›´æ–°åçš„è§†å›¾ã€‚ä¹Ÿå°±æ˜¯è¯´è§†å›¾æ˜¯ç”±æ§åˆ¶å™¨å’Œæ¨¡å‹æ§åˆ¶çš„
MVTæ¨¡å¼çš„å¤„ç†é€»è¾‘ç¨æœ‰ä¸åŒï¼šå½“ä¸€ä¸ªç”¨æˆ·å‘èµ·ä¸€æ¬¡HTTPè¯·æ±‚åï¼Œç›¸å…³çš„è§†å›¾å°†é€šè¿‡æ¨¡å‹æ‰§è¡Œä¸€æ¬¡æŸ¥è¯¢ï¼Œè¿›è€Œè·å–æŸ¥è¯¢çš„ç»“æœï¼Œæœ€åè§†å›¾å°†ç»“æœæ•°æ®å¡«è¿›æ¨¡æ¿åå‘é€ç»™ç”¨æˆ·

+ èŒè´£åˆ’åˆ†
  - åœ¨MVCä¸­ï¼ŒControllerè´Ÿè´£å¤„ç†ç”¨æˆ·è¾“å…¥å’Œä¸šåŠ¡é€»è¾‘ï¼ŒViewè´Ÿè´£å±•ç¤ºæ•°æ®
  - åœ¨MTVä¸­ï¼ŒViewï¼ˆè§†å›¾ï¼‰è´Ÿè´£å¤„ç†HTTPè¯·æ±‚ï¼Œåè°ƒModelå’ŒTemplateï¼Œè€ŒTemplateè´Ÿè´£å±•ç¤ºæ•°æ®

+ çµæ´»æ€§
  - MVCæ¨¡å¼åœ¨æ¡Œé¢åº”ç”¨å’ŒWebåº”ç”¨ä¸­éƒ½æœ‰å¹¿æ³›åº”ç”¨
  - MTVæ¨¡å¼ç‰¹åˆ«é€‚åˆWebå¼€å‘ï¼Œå°¤å…¶æ˜¯æ•°æ®é©±åŠ¨çš„åº”ç”¨ï¼Œå› ä¸ºTemplateå¯ä»¥æ›´çµæ´»åœ°ç”ŸæˆåŠ¨æ€å†…å®¹

<img width="810" height="480" alt="image" src="https://github.com/user-attachments/assets/b883c2bf-d0cf-4af0-86fc-2d754cb7cb9b" />


## DDDåˆ†å±‚ä¸Djangoåˆ†å±‚æ¨¡å¼å¯¹åº”å…³ç³»ï¼ˆDDDè§†è§’ï¼‰
|Level|DDD|Django|
|-----|-----|------|
|è¡¨ç°å±‚|è´Ÿè´£ä¸ç”¨æˆ·äº¤äº’ï¼Œå±•ç¤ºæ•°æ®å’Œå¤„ç†ç”¨æˆ·è¾“å…¥|View+Temaplteå…±åŒæ„æˆDDDè¡¨ç°å±‚ã€æ— ä¸šåŠ¡é€»è¾‘|
|åº”ç”¨å±‚|åè°ƒä¸šåŠ¡æµç¨‹ï¼Œå¤„ç†ç”¨ä¾‹ï¼Œè°ƒç”¨é¢†åŸŸå±‚æœåŠ¡ï¼›æ­¤å±‚å¯ä»¥åŒ…å«ç®€å•çš„æŸ¥è¯¢é€»è¾‘ï¼Œä½†æ ¸å¿ƒå¤æ‚ä¸šåŠ¡é€»è¾‘å¿…é¡»ä¸‹æ²‰åˆ°é¢†åŸŸå±‚|View+è‡ªå®šä¹‰Serviceç±»ï¼ˆå¤„ç†å¤æ‚çš„ä¸šåŠ¡é€»è¾‘ï¼Œè€Œä¸ç›´æ¥åœ¨è§†å›¾ä¸­å®ç°ï¼‰ï¼›\nè§†å›¾å¯ä»¥ä½œä¸ºåº”ç”¨å±‚çš„å…¥å£ï¼Œè°ƒç”¨æœåŠ¡ç±»å¤„ç†ä¸šåŠ¡é€»è¾‘ï¼›åº”ç”¨æœåŠ¡ç±»åè°ƒé¢†åŸŸå±‚çš„æœåŠ¡ã€‚|
|é¢†åŸŸå±‚|åŒ…å«ä¸šåŠ¡é€»è¾‘ã€å®ä½“ã€å€¼å¯¹è±¡ã€ä»“å‚¨æ¥å£å®šä¹‰ç­‰æ ¸å¿ƒä¸šåŠ¡æ¨¡å‹|Modelï¼ˆé¿å…ç›´æ¥ä¾èµ–djangoçš„ormï¼‰+è‡ªå®šä¹‰é¢†åŸŸæœåŠ¡ï¼ˆåœ¨æ¨¡å‹ä¸­æˆ–å¤–éƒ¨å®ç°é¢†åŸŸæœåŠ¡ï¼Œå¤„ç†æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ï¼‰|
|åŸºç¡€è®¾æ–½å±‚|å¤„ç†ä¸å¤–éƒ¨ç³»ç»Ÿçš„äº¤äº’ï¼Œå¦‚æ•°æ®åº“è®¿é—®ã€æ¶ˆæ¯é˜Ÿåˆ—ã€å¤–éƒ¨APIè°ƒç”¨ç­‰ï¼›ä»“å‚¨å®ç°å±‚+POæŒä¹…åŒ–å±‚|æ•°æ®åº“åç«¯+ç®¡ç†å™¨ç±»+ç¬¬ä¸‰æ–¹åº“å’ŒAPIï¼›djangoä¸­çš„æŸäº›ä¸­é—´ä»¶ä¹Ÿå±äºåŸºç¡€è®¾æ–½å±‚|
|ä»“å‚¨æ¨¡å¼|ç”¨äºå°†æ•°æ®åº“è®¿é—®é€»è¾‘ä»é¢†åŸŸå±‚åˆ†ç¦»ä¿æŒé¢†åŸŸå±‚çš„ç‹¬ç«‹æ€§|djangoå¯ä»¥é€šè¿‡ è‡ªå®šä¹‰ä»“å‚¨ç±»+ä½¿ç”¨djangoçš„orm å®ç°ä»“å‚¨æ¨¡å¼ï¼ˆç¡®ä¿é¢†åŸŸå±‚ä¸ç›´æ¥ä¾èµ–ORMï¼‰ã€‚è§[ç¤ºä¾‹ä»£ç ](#ddd01)|
|é¢†åŸŸäº‹ä»¶|ç”¨äºå¤„ç†é¢†åŸŸå†…çš„äº‹ä»¶é©±åŠ¨é€»è¾‘|å¯ä»¥ä½¿ç”¨ä¿¡å· signals å®ç°é¢†åŸŸäº‹ä»¶çš„å¤„ç†|

**<span id='ddd01'>ä»“å‚¨æ¨¡å¼ç¤ºä¾‹ä»£ç </span>**   
```
# ä»“å‚¨æ¥å£
class UserRepository(ABC):
    @abstractmethod
    def get_user(self, user_id):
        pass

# ä»“å‚¨å®ç°
class DjangoUserRepository(UserRepository):
    def get_user(self, user_id):
        return User.objects.get(id=user_id)
```

## DDDç¤ºä¾‹é¡¹ç›®ä¸€ï¼šå›¾ä¹¦ç®¡ç†ç³»ç»Ÿ
æ•…äº‹ï¼šæˆ‘éœ€è¦ä¸€ä¸ªå›¾ä¹¦ç®¡ç†ç³»ç»Ÿï¼ŒåŒ…å«å›¾ä¹¦å…¥åº“ï¼Œå€Ÿé˜…ï¼Œå½’è¿˜ï¼Œå€Ÿé˜…ä¸´è¿‘æ—¥çŸ­ä¿¡æé†’ç­‰åŠŸèƒ½ï¼Œè¯·ä½¿ç”¨DDDåˆ†å±‚æ¶æ„æ€æƒ³å®ç°è¿™æ ·çš„ç³»ç»Ÿ
æˆ‘ä»¬ä½¿ç”¨ fastapi+sqlalchemyæ¥å®ç°è¿™æ ·ä¸€ä¸ªç³»ç»Ÿ
### 1ã€é¡¹ç›®åˆå§‹åŒ–
```
mkdir library_management_system
cd library_management_system
python -m venv venv
source venv/bin/activate  # åœ¨Windowsä¸Šä½¿ç”¨ .\venv\Scripts\activate
pip install fastapi sqlalchemy python-dotenv
```
### 2ã€é¡¹ç›®ç»“æ„è®¾è®¡
æ ¹æ®DDDåˆ†å±‚æ¶æ„ï¼Œè®¾è®¡é¡¹ç›®çš„ç›®å½•ç»“æ„ï¼š
```
library_management_system/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ domain/
â”‚   â”‚   â”œâ”€â”€ models.py  # å®ä½“ç±»
â”‚   â”‚   â””â”€â”€ services.py  # é¢†åŸŸæœåŠ¡
â”‚   â”œâ”€â”€ application/
â”‚   â”‚   â””â”€â”€ services.py  # åº”ç”¨æœåŠ¡
â”‚   â””â”€â”€ infrastructure/
â”‚       â”œâ”€â”€ repositories/
â”‚       â”‚   â””â”€â”€ book_repository.py
â”‚       â””â”€â”€ notification_service.py
â”œâ”€â”€ presentation/
â”‚   â””â”€â”€ routes.py
â”œâ”€â”€ main.py  # FastAPIåº”ç”¨å…¥å£
â””â”€â”€ .env  # ç¯å¢ƒå˜é‡é…ç½®
```
### 3ã€é¢†åŸŸå±‚å®ç°
**åœ¨app/domain/models.pyä¸­å®šä¹‰å®ä½“ç±»**ï¼š  
```python
from datetime import datetime

class Book:
    def __init__(self, book_id, title, author, isbn):
        self.book_id = book_id
        self.title = title
        self.author = author
        self.isbn = isbn
        self.status = "available"  # available, borrowed, maintenance

    def borrow(self):
        if self.status == "available":
            self.status = "borrowed"
            return True
        return False

    def return_book(self):
        if self.status == "borrowed":
            self.status = "available"
            return True
        return False

class BorrowRecord:
    def __init__(self, record_id, book, user, borrow_date):
        self.record_id = record_id
        self.book = book
        self.user = user
        self.borrow_date = borrow_date
        self.return_date = borrow_date + datetime.timedelta(days=14)  # é»˜è®¤å€ŸæœŸ14å¤©

    def days_remaining(self):
        today = datetime.datetime.today()
        delta = self.return_date - today
        return delta.days

    def is_overdue(self):
        today = datetime.datetime.today()
        return today > self.return_date
```
**åœ¨app/domain/services.pyä¸­å®šä¹‰é¢†åŸŸæœåŠ¡**ï¼š  
```python
class BookManagementService:
    def __init__(self, book_repository):
        self.book_repository = book_repository

    def add_book(self, book):
        self.book_repository.save(book)

    def borrow_book(self, book_id, user):
        book = self.book_repository.find_by_id(book_id)
        if book.borrow():
            borrow_record = BorrowRecord(
                record_id=generate_id(),
                book=book,
                user=user,
                borrow_date=datetime.datetime.today()
            )
            self.book_repository.save_borrow_record(borrow_record)
            return True
        return False

    def return_book(self, book_id):
        book = self.book_repository.find_by_id(book_id)
        if book.return_book():
            self.book_repository.update_book(book)
            return True
        return False
```
### 4ã€åº”ç”¨å±‚å®ç°
**åœ¨app/application/services.pyä¸­å®šä¹‰åº”ç”¨æœåŠ¡**ï¼š  
```python
class BookApplicationService:
    def __init__(self, book_management_service, notification_service):
        self.book_management_service = book_management_service
        self.notification_service = notification_service

    def add_book(self, book):
        self.book_management_service.add_book(book)

    def borrow_book(self, book_id, user):
        success = self.book_management_service.borrow_book(book_id, user)
        if success:
            self.notification_service.send_borrow_confirmation(user, book_id)
        return success

    def return_book(self, book_id):
        success = self.book_management_service.return_book(book_id)
        if success:
            self.notification_service.send_return_confirmation(book_id)
        return success

    def check_overdue(self):
        records = self.book_management_service.get_all_borrow_records()
        for record in records:
            if record.is_overdue():
                self.notification_service.send_overdue_notification(record.user, record.book)
```
### 5ã€åŸºç¡€è®¾æ–½å±‚å®ç°
**åœ¨app/infrastructure/repositories/book_repository.pyä¸­å®šä¹‰ä¹¦ç±ä»“åº“**ï¼š  
```python
from sqlalchemy import create_engine, Column, Integer, String, Date
from sqlalchemy.ext.declarative import declarative_base
from sqlalchemy.orm import sessionmaker

Base = declarative_base()

class BookDB(Base):
    __tablename__ = 'books'
    book_id = Column(Integer, primary_key=True)
    title = Column(String)
    author = Column(String)
    isbn = Column(String)
    status = Column(String)

class BorrowRecordDB(Base):
    __tablename__ = 'borrow_records'
    record_id = Column(Integer, primary_key=True)
    book_id = Column(Integer)
    user_id = Column(Integer)
    borrow_date = Column(Date)
    return_date = Column(Date)

engine = create_engine('sqlite:///library.db')
Base.metadata.create_all(engine)
Session = sessionmaker(bind=engine)
session = Session()

class BookRepository:
    def save(self, book):
        book_db = BookDB(
            book_id=book.book_id,
            title=book.title,
            author=book.author,
            isbn=book.isbn,
            status=book.status
        )
        session.add(book_db)
        session.commit()

    def find_by_id(self, book_id):
        book_db = session.query(BookDB).filter_by(book_id=book_id).first()
        if not book_db:
            return None
        return Book(
            book_id=book_db.book_id,
            title=book_db.title,
            author=book_db.author,
            isbn=book_db.isbn,
            status=book_db.status
        )

    def save_borrow_record(self, borrow_record):
        borrow_record_db = BorrowRecordDB(
            record_id=borrow_record.record_id,
            book_id=borrow_record.book.book_id,
            user_id=borrow_record.user.user_id,
            borrow_date=borrow_record.borrow_date,
            return_date=borrow_record.return_date
        )
        session.add(borrow_record_db)
        session.commit()

    def get_all_borrow_records(self):
        records_db = session.query(BorrowRecordDB).all()
        records = []
        for record_db in records_db:
            book = self.find_by_id(record_db.book_id)
            user = User(user_id=record_db.user_id, name="", phone_number="")
            record = BorrowRecord(
                record_id=record_db.record_id,
                book=book,
                user=user,
                borrow_date=record_db.borrow_date
            )
            records.append(record)
        return records

    def update_book(self, book):
        book_db = session.query(BookDB).filter_by(book_id=book.book_id).first()
        if book_db:
            book_db.status = book.status
            session.commit()
```
**åœ¨app/infrastructure/notification_service.pyä¸­å®šä¹‰é€šçŸ¥æœåŠ¡**ï¼š  
```python
class SMSNotificationService:
    def send_borrow_confirmation(self, user, book_id):
        message = f"æ‚¨å·²æˆåŠŸå€Ÿé˜…ä¹¦ç±ï¼ŒID: {book_id}ã€‚è¯·æŒ‰æ—¶å½’è¿˜ã€‚"
        self.send_sms(user.phone_number, message)

    def send_return_confirmation(self, book_id):
        message = f"ä¹¦ç±ID: {book_id}å·²æˆåŠŸå½’è¿˜ã€‚æ„Ÿè°¢æ‚¨çš„ä½¿ç”¨ã€‚"
        self.send_sms("library@system.com", message)

    def send_overdue_notification(self, user, book):
        message = f"æ‚¨å€Ÿé˜…çš„ä¹¦ç±ã€Š{book.title}ã€‹å·²é€¾æœŸï¼Œè¯·å°½å¿«å½’è¿˜ã€‚"
        self.send_sms(user.phone_number, message)

    def send_sms(self, recipient, message):
        # è°ƒç”¨çŸ­ä¿¡APIå‘é€çŸ­ä¿¡
        pass
```

### 6ã€è¡¨ç°å±‚å®ç°
**åœ¨presentation/routes.pyä¸­å®šä¹‰APIè·¯ç”±**ï¼š  
```python
from fastapi import APIRouter, HTTPException
from app.domain.models import Book
from app.application.services import BookApplicationService

router = APIRouter()

@router.post("/books")
async def add_book(book: Book):
    try:
        BookApplicationService.add_book(book)
        return {"message": "Book added successfully"}
    except Exception as e:
        raise HTTPException(status_code=400, detail=str(e))

@router.post("/borrow")
async def borrow_book(book_id: int, user: User):
    try:
        success = BookApplicationService.borrow_book(book_id, user)
        if success:
            return {"message": "Book borrowed successfully"}
        else:
            return {"message": "Book is not available"}
    except Exception as e:
        raise HTTPException(status_code=400, detail=str(e))

@router.post("/return")
async def return_book(book_id: int):
    try:
        success = BookApplicationService.return_book(book_id)
        if success:
            return {"message": "Book returned successfully"}
        else:
            return {"message": "Return failed"}
    except Exception as e:
        raise HTTPException(status_code=400, detail=str(e))

@router.get("/check-overdue")
async def check_overdue():
    try:
        BookApplicationService.check_overdue()
        return {"message": "Overdue check completed"}
    except Exception as e:
        raise HTTPException(status_code=500, detail=str(e))
```
### 7ã€FastAPIåº”ç”¨å…¥å£
**åœ¨main.pyä¸­å®šä¹‰FastAPIåº”ç”¨**ï¼š  
```python
from fastapi import FastAPI
from app.domain.services import BookManagementService
from app.infrastructure.repositories import BookRepository
from app.infrastructure.notification_service import SMSNotificationService
from app.application.services import BookApplicationService
from presentation.routes import router

app = FastAPI()

# ä¾èµ–æ³¨å…¥
book_repository = BookRepository()
notification_service = SMSNotificationService()
book_management_service = BookManagementService(book_repository)
book_application_service = BookApplicationService(book_management_service, notification_service)

app.include_router(router)
```
### 8ã€ç¯å¢ƒå˜é‡é…ç½®
**åœ¨.envæ–‡ä»¶ä¸­é…ç½®æ•°æ®åº“è¿æ¥å’Œå…¶ä»–ç¯å¢ƒå˜é‡**ï¼š  
```
DATABASE_URL = "sqlite:///library.db"
```

### 9ã€è¿è¡Œåº”ç”¨
```
uvicorn main:app --reload
```

### 10ã€è§£é‡Š
ç”¨DDDåšé¡¹ç›®çš„æ ¸å¿ƒç»“è®ºæ˜¯ï¼šâ€œä»å¤§åˆ°å°ã€ä»æŠ½è±¡åˆ°å…·ä½“â€ çš„å±‚çº§å…³è”ï¼Œæ ¸å¿ƒé€»è¾‘æ˜¯ â€œé¢†åŸŸæ‹†åˆ†å­åŸŸï¼Œå­åŸŸç”¨é™ç•Œä¸Šä¸‹æ–‡è½åœ°ï¼Œä¸Šä¸‹æ–‡å†…ç”¨èšåˆå°è£…æ•°æ®è¡Œä¸ºï¼Œèšåˆæ ¹ç»Ÿä¸€å¯¹å¤–äº¤äº’â€
+ é¢†åŸŸï¼šæ•´ä¸ªå›¾ä¹¦ç®¡ç†ç³»ç»Ÿæ˜¯ä¸€ä¸ªå¤§é¢†åŸŸï¼ŒåŒ…å«äº†æ‰€æœ‰ä¸å›¾ä¹¦ç®¡ç†ç›¸å…³çš„ä¸šåŠ¡é€»è¾‘
+ å­åŸŸï¼šå¦‚ç”µå•†ç³»ç»Ÿä¸­ï¼ˆé¢†åŸŸï¼‰ï¼Œè®¢å•ç®¡ç†ã€åº“å­˜ç®¡ç†ã€ç”¨æˆ·ç®¡ç†æ˜¯ä¸åŒçš„å­åŸŸ
  - å›¾ä¹¦ç®¡ç†å­åŸŸï¼ˆå›¾ä¹¦ç®¡ç†ä¸Šä¸‹æ–‡ï¼‰
  - å€Ÿé˜…ç®¡ç†å­åŸŸï¼ˆå€Ÿé˜…ç®¡ç†ä¸Šä¸‹æ–‡ï¼‰
+ é™ç•Œä¸Šä¸‹æ–‡ï¼šé™ç•Œä¸Šä¸‹æ–‡å®šä¹‰äº†å­åŸŸçš„è¾¹ç•Œå’Œè¯­ä¹‰ã€‚å¹¶å¸®åŠ©æˆ‘ä»¬æ˜ç¡®ä¸åŒå­åŸŸä¹‹é—´çš„å…³ç³»å’Œäº¤äº’æ–¹å¼

## DDDç¤ºä¾‹é¡¹ç›®äºŒï¼šç”µå•†ç³»ç»Ÿ
æ¥ç€è¦åšä¸€ä¸ªç”µå­å•†åŠ¡å¹³å°ï¼Œç”¨æˆ·å¯åœ¨å¹³å°è´­ä¹°ä¸œè¥¿

### 1ã€é¢†åŸŸï¼šæœ€å¤§çš„â€œä¸šåŠ¡èŒƒå›´å®¹å™¨â€
+ å®šä¹‰ï¼šå®šä¹‰ï¼šå¯¹åº”ä¸€ä¸ªå®Œæ•´çš„ä¸šåŠ¡é¢†åŸŸï¼Œæ˜¯æ‰€æœ‰ç›¸å…³ä¸šåŠ¡çš„é›†åˆï¼ŒèŒƒå›´æœ€å¹¿ã€æœ€æŠ½è±¡ã€‚
+ ä¸¾ä¾‹ï¼šâ€œç”µå•†ç³»ç»Ÿâ€ å°±æ˜¯ä¸€ä¸ªé¢†åŸŸï¼ŒåŒ…å«æ‰€æœ‰å’Œ â€œç½‘ä¸Šä¹°ä¸œè¥¿â€ ç›¸å…³çš„ä¸šåŠ¡ï¼ˆä¸‹å•ã€ä»˜æ¬¾ã€å‘è´§ã€å•†å“ç®¡ç†ç­‰ï¼‰

### 2ã€å­åŸŸï¼šé¢†åŸŸçš„â€œåŠŸèƒ½æ‹†åˆ†æ¨¡å—â€
+ å®šä¹‰ï¼š æŠŠå¤§é¢†åŸŸæŒ‰ â€œèŒè´£ + é‡è¦æ€§â€ æ‹†æˆçš„å°æ¨¡å—ï¼Œé¿å…é¢†åŸŸè¿‡äºåºå¤§
+ åˆ†ç±» + ç”µå•†ä¸¾ä¾‹
  - æ ¸å¿ƒå­åŸŸï¼šä¸šåŠ¡æ ¸å¿ƒä»·å€¼ï¼ˆè®¢å•å­åŸŸã€å•†å“å­åŸŸã€æ”¯ä»˜å­åŸŸï¼‰
  - æ”¯æ’‘å­åŸŸï¼šè¾…åŠ©æ ¸å¿ƒä¸šåŠ¡ï¼ˆç‰©æµå­åŸŸï¼Œè´Ÿè´£å‘è´§é…é€ï¼‰
  - é€šç”¨å­åŸŸï¼šå¤šä¸ªå­åŸŸå…±ç”¨ï¼ˆç”¨æˆ·è®¤è¯å­åŸŸï¼Œè´Ÿè´£ç™»å½•æˆæƒï¼‰
+ å…³ç³»ï¼š ä¸€ä¸ªé¢†åŸŸåŒ…å«å¤šä¸ªå­åŸŸï¼Œ å­åŸŸä¹‹é—´æ˜¯â€œåä½œå…³ç³»â€ï¼ˆæ¯”å¦‚è®¢å•å­åŸŸè¦ä¾èµ–å•†å“å­åŸŸæŸ¥åº“å­˜ï¼‰

### 3ã€é™ç•Œä¸Šä¸‹æ–‡ï¼š å­åŸŸçš„â€œè¾¹ç•Œâ€ + å…·ä½“å®ç°
+ å®šä¹‰ï¼šç»™å­åŸŸåˆ’æ¸… â€œè¯­ä¹‰è¾¹ç•Œâ€ å’Œ â€œæŠ€æœ¯è¾¹ç•Œâ€ï¼Œè¾¹ç•Œå†…çš„æœ¯è¯­ã€è§„åˆ™ã€å¯¹è±¡æœ‰ç»Ÿä¸€å«ä¹‰ï¼Œå¤–éƒ¨ä¸èƒ½ç›´æ¥å¹²æ¶‰å†…éƒ¨é€»è¾‘ã€‚
+ ç”µå•†ä¸¾ä¾‹ï¼š
  - å•†å“å­åŸŸå¯¹åº” â€œå•†å“ç®¡ç†ä¸Šä¸‹æ–‡â€ï¼ˆé‡Œé¢çš„ â€œåº“å­˜â€â€œè§„æ ¼â€ æœ¯è¯­ä»…åœ¨æ­¤ä¸Šä¸‹æ–‡å†…ç»Ÿä¸€ï¼Œæ¯”å¦‚ â€œåº“å­˜â€ æŒ‡å•†å“å¯å”®æ•°é‡ï¼Œå’Œå…¶ä»–ä¸Šä¸‹æ–‡çš„ â€œåº“å­˜â€ æ— å…³ï¼‰
  - è®¢å•å­åŸŸå¯¹åº” â€œè®¢å•ç®¡ç†ä¸Šä¸‹æ–‡â€ï¼ˆé‡Œé¢çš„ â€œä¸‹å•â€â€œå–æ¶ˆè®¢å•â€ è§„åˆ™åªé€‚ç”¨äºè®¢å•ä¸šåŠ¡ï¼‰
+ å…³ç³»ï¼š1 ä¸ªå­åŸŸé€šå¸¸å¯¹åº” 1 ä¸ªé™ç•Œä¸Šä¸‹æ–‡ï¼ˆå¤æ‚å­åŸŸå¯æ‹†å¤šä¸ªï¼‰ï¼Œé™ç•Œä¸Šä¸‹æ–‡æ˜¯å­åŸŸçš„ â€œè½åœ°è½½ä½“â€ã€‚

### 4ã€èšåˆï¼šé™ç•Œä¸Šä¸‹æ–‡å†…çš„â€œæœ€å°ä¸šåŠ¡å•å…ƒâ€
+ å®šä¹‰ï¼šæŠŠé™ç•Œä¸Šä¸‹æ–‡å†… â€œå¼ºå…³è”çš„å¯¹è±¡â€ æ‰“åŒ…æˆä¸€ä¸ªæ•´ä½“ï¼Œç¡®ä¿æ•°æ®ä¸€è‡´æ€§ï¼ˆæ¯”å¦‚æ”¹ä¸€ä¸ªå¯¹è±¡å¿…é¡»åŒæ­¥æ”¹å…³è”å¯¹è±¡ï¼‰ã€‚
+ ç”µå•†ä¸¾ä¾‹ï¼š
  - å•†å“ç®¡ç†ä¸Šä¸‹æ–‡å†…ï¼Œâ€œå•†å“â€â€œå•†å“è§„æ ¼â€â€œåº“å­˜â€ å¼ºå…³è”ï¼ˆæ”¹å•†å“è§„æ ¼è¦åŒæ­¥è°ƒæ•´åº“å­˜ï¼Œåˆ å•†å“è¦ä¸€èµ·åˆ è§„æ ¼å’Œåº“å­˜ï¼‰ï¼Œæ‰“åŒ…æˆ â€œå•†å“èšåˆâ€
  - è®¢å•ç®¡ç†ä¸Šä¸‹æ–‡å†…ï¼Œâ€œè®¢å•â€â€œè®¢å•é¡¹â€â€œæ”¶è´§åœ°å€â€ å¼ºå…³è”ï¼ˆåˆ è®¢å•è¦ä¸€èµ·åˆ è®¢å•é¡¹å’Œåœ°å€ï¼‰ï¼Œæ‰“åŒ…æˆ â€œè®¢å•èšåˆâ€ã€‚
+ å…³ç³»ï¼š1 ä¸ªé™ç•Œä¸Šä¸‹æ–‡åŒ…å«å¤šä¸ªèšåˆï¼Œèšåˆä¹‹é—´æ˜¯ â€œæ¾è€¦åˆâ€ï¼ˆæ¯”å¦‚å•†å“èšåˆå’Œè®¢å•èšåˆé€šè¿‡ â€œå•†å“ IDâ€ å…³è”ï¼Œä¸ç›´æ¥æ“ä½œå¯¹æ–¹å†…éƒ¨å¯¹è±¡ï¼‰

### 5ã€èšåˆæ ¹ï¼šèšåˆçš„â€œå…¥å£+ç®¡ç†è€…â€
+ å®šä¹‰ï¼šèšåˆå†…çš„ â€œæ ¸å¿ƒå¯¹è±¡â€ï¼Œå¤–éƒ¨åªèƒ½é€šè¿‡å®ƒè®¿é—®èšåˆå†…çš„å…¶ä»–å¯¹è±¡ï¼Œè´Ÿè´£ç»´æŠ¤èšåˆçš„æ•°æ®ä¸€è‡´æ€§ã€‚
+ ç”µå•†ä¸¾ä¾‹ï¼š
  - å•†å“èšåˆçš„èšåˆæ ¹æ˜¯ â€œå•†å“â€ï¼šè¦æ‰£å‡åº“å­˜ï¼Œå¿…é¡»é€šè¿‡ â€œå•†å“ã€‚æ‰£å‡åº“å­˜ ()â€ æ–¹æ³•ï¼Œä¸èƒ½ç›´æ¥æ”¹ â€œåº“å­˜â€ å¯¹è±¡ï¼›
  - è®¢å•èšåˆçš„èšåˆæ ¹æ˜¯ â€œè®¢å•â€ï¼šè¦æ·»åŠ è®¢å•é¡¹ï¼Œå¿…é¡»é€šè¿‡ â€œè®¢å•ã€‚æ·»åŠ è®¢å•é¡¹ ()â€ æ–¹æ³•ï¼Œä¸èƒ½ç›´æ¥åˆ›å»ºè®¢å•é¡¹ã€‚
+ å…³ç³»ï¼š1 ä¸ªèšåˆåªæœ‰ 1 ä¸ªèšåˆæ ¹ï¼Œèšåˆæ ¹æ˜¯èšåˆå¯¹å¤–çš„ â€œå”¯ä¸€æ¥å£â€ã€‚

### å¯è§†åŒ–å…³ç³»å›¾ï¼ˆç”µå•†åœºæ™¯ï¼‰
ç”¨ç®€å•çš„å±‚çº§å›¾å±•ç¤ºï¼Œç›´è§‚çœ‹åˆ°ä»å¤§åˆ°å°çš„å…³è”ï¼š
<img width="3796" height="1072" alt="image" src="https://github.com/user-attachments/assets/0159fd85-e6b5-434f-9da2-49796578913a" />

### ç”µå•†åœºæ™¯ERå›¾è¯¦è§£
<img width="836" height="2291" alt="image" src="https://github.com/user-attachments/assets/125cbfe0-d8b6-40ed-9444-47ce0213ea6c" />

### æ€»ç»“ç”µå•†é¢†åŸŸ
æŠŠç”µå•†é¢†åŸŸæ¯”ä½œ â€œä¸€ä¸ªå¤§å•†åœºâ€ï¼š
+ é¢†åŸŸ = æ•´ä¸ªå•†åœº
+ å­åŸŸ = å•†åœºé‡Œçš„ â€œæœè£…åŒºã€é£Ÿå“åŒºã€æ”¶é“¶å°ã€ä¿å®‰éƒ¨â€
+ é™ç•Œä¸Šä¸‹æ–‡ = æ¯ä¸ªåŒºåŸŸçš„ â€œå›´æ  + å·¥ä½œäººå‘˜â€ï¼ˆå›´æ åˆ’æ¸…è¾¹ç•Œï¼Œå·¥ä½œäººå‘˜æŒ‰åŒºåŸŸè§„åˆ™åšäº‹ï¼‰
+ èšåˆ = æœè£…åŒºé‡Œçš„ â€œä¸€å¥—ç©¿æ­ï¼ˆè¡£æœ + è£¤å­ + é‹å­ï¼‰â€ï¼ˆå¼ºå…³è”ï¼Œä¹°ä¸€å¥—è¦ä¸€èµ·æ‹¿ï¼‰
+ èšåˆæ ¹ = è¿™å¥—ç©¿æ­çš„ â€œå¯¼è´­â€ï¼ˆè¦è¯•ç©¿ã€è´­ä¹°åªèƒ½æ‰¾å¯¼è´­ï¼Œä¸èƒ½ç›´æ¥æ‹¿è¡£æœï¼‰

### é¡¹ç›®ç›®å½•ç»“æ„ç¤ºä¾‹
```
application/  # åº”ç”¨å±‚
â”œâ”€â”€ services/  # åº”ç”¨æœåŠ¡ï¼Œå¤„ç†ç”¨æˆ·çš„è¯·æ±‚å¹¶åè°ƒé¢†åŸŸæœåŠ¡
â”‚   â”œâ”€â”€ order_service.py
â”‚   â””â”€â”€ user_service.py
â”œâ”€â”€ commands/  # å®šä¹‰å‘½ä»¤å¤„ç†å™¨ï¼Œ å¤„ç†ç”¨æˆ·å‘½ä»¤è¯·æ±‚
â”‚   â”œâ”€â”€ create_order_command.py
â”‚   â””â”€â”€ update_product_command.py
â””â”€â”€ queries/  # å®šä¹‰æŸ¥è¯¢å¤„ç†å™¨ï¼Œå¤„ç†ç”¨æˆ·æŸ¥è¯¢è¯·æ±‚
    â”œâ”€â”€ get_order_query.py
    â””â”€â”€ list_products_query.py

core/  # æ ¸å¿ƒé¢†åŸŸå±‚
â”œâ”€â”€ entities/  # ä¸šåŠ¡å®ä½“
â”‚   â”œâ”€â”€ order.py
â”‚   â”œâ”€â”€ product.py
â”‚   â””â”€â”€ user.py
â”œâ”€â”€ value_objects/  # å€¼å¯¹è±¡
â”‚   â”œâ”€â”€ money.py
â”‚   â””â”€â”€ address.py
â”œâ”€â”€ domain_services/  # é¢†åŸŸæœåŠ¡
â”‚   â”œâ”€â”€ order_service.py
â”‚   â””â”€â”€ inventory_service.py
â””â”€â”€ repositories/  # ä»“åº“æ¥å£ï¼Œç”¨äºæ•°æ®æŒä¹…åŒ–
    â”œâ”€â”€ order_repository.py
    â””â”€â”€ product_repository.py
    
infrastructure/  # åŸºç¡€è®¾æ–½å±‚
â”œâ”€â”€ database/
â”‚   â”œâ”€â”€ models/  # ORMæ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ order_model.py
â”‚   â”‚   â””â”€â”€ product_model.py
â”‚   â”œâ”€â”€ repositories/  # ä»“åº“çš„å…·ä½“å®ç°  å¦‚ xxxImpl
â”‚   â”‚   â”œâ”€â”€ order_repository_impl.py
â”‚   â”‚   â””â”€â”€ product_repository_impl.py
â”‚   â””â”€â”€ db_config.py  # æ•°æ®åº“é…ç½®
â”œâ”€â”€ logging/
â”‚   â””â”€â”€ logger.py
â”œâ”€â”€ external_apis/  # å¤–éƒ¨APIå®¢æˆ·ç«¯ï¼Œå¦‚æ”¯ä»˜ç½‘å…³ã€é€šçŸ¥æœåŠ¡
â”‚   â”œâ”€â”€ payment_gateway.py
â”‚   â””â”€â”€ notification_service.py
â””â”€â”€ cache/  # ç¼“å­˜å®ç°
    â””â”€â”€ redis_cache.py

docs/
â”œâ”€â”€ architecture.md
â”œâ”€â”€ domain_model.md
â””â”€â”€ api_reference.md

# .env
DB_NAME=my_project
DB_USER=root
DB_PASSWORD=secret
```

## DDDç¤ºä¾‹é¡¹ç›®ä¸‰ï¼šç®€å†è§£æå·¥å…·

### é¡¹ç›®ç›®æ ‡
1. ç”¨æˆ·æ³¨å†Œï¼ˆé‚®ç®± + éªŒè¯ç ï¼‰
2. ä¸Šä¼ ç®€å†ï¼ˆPDF/Wordï¼‰
3. åå°å¼‚æ­¥è§£æç®€å†å†…å®¹ï¼ˆå¦‚å§“åã€ç”µè¯ã€å·¥ä½œç»å†ç­‰ï¼‰
4. ç”¨æˆ·å¯åˆ·æ–°æŸ¥çœ‹è§£æç»“æœ
5. ç”¨æˆ·æ³¨å†ŒæˆåŠŸå‘é€æ—¶é—´å¼‚æ­¥å‘é€æ¬¢è¿é‚®ä»¶

### DDDåˆ†å±‚æ¶æ„æ¶‰åŠï¼ˆå…­è¾¹å½¢æ¶æ„ï¼‰
```
+-------------------------+
|         API Layer     | â† FastAPI è·¯ç”± + Pydantic
+-------------------------+
            â†“
+-------------------------+
|       Application Layer | â† åº”ç”¨æœåŠ¡ï¼ˆUse Caseï¼‰
+-------------------------+
            â†“
+-------------------------+
|      Domain Layer     | â† æ ¸å¿ƒé¢†åŸŸæ¨¡å‹ + é¢†åŸŸæœåŠ¡
+-------------------------+
            â†“
+-------------------------+
|   Infrastructure Layer | â† æ•°æ®åº“ã€æ¶ˆæ¯é˜Ÿåˆ—ã€é‚®ä»¶æœåŠ¡
+-------------------------+
```

### æŠ€æœ¯æ ˆ
+ FastAPIï¼šå¼‚æ­¥ Web æ¡†æ¶ï¼Œæ”¯æŒ OpenAPI/Swagger
+ Pydanticï¼šæ•°æ®æ ¡éªŒä¸åºåˆ—åŒ–
+ SQLModel / SQLAlchemyï¼šORMï¼ˆç”¨äºå­˜å‚¨ç”¨æˆ·ã€ç®€å†å…ƒæ•°æ®ï¼‰
+ RabbitMQ æˆ– Redisï¼šå¼‚æ­¥ä»»åŠ¡é˜Ÿåˆ—ï¼ˆè§£æç®€å†ï¼‰
+ Celeryï¼šåˆ†å¸ƒå¼ä»»åŠ¡å¤„ç†ï¼ˆå¯é€‰ï¼‰
+ Nodemailer / SendGrid / SMTPï¼šå‘é€é‚®ä»¶éªŒè¯ç 
+ PDFMiner / docx2txt / PyPDF2ï¼šç®€å†æ–‡ä»¶è§£æ
+ Redisï¼šç¼“å­˜è§£æç»“æœã€éªŒè¯ç ï¼ˆä¸´æ—¶ï¼‰

### é¡¹ç›®ç›®å½•ç»“æ„
```
resume-parser/
â”œâ”€â”€ main.py                          # FastAPI å…¥å£
â”œâ”€â”€ config.py                        # é…ç½®ç±»ï¼ˆæ•°æ®åº“ã€é‚®ä»¶ã€Redisç­‰ï¼‰
â”‚
â”œâ”€â”€ domain/
â”‚   â”œâ”€â”€ entities/                  # é¢†åŸŸå®ä½“
â”‚   â”‚   â”œâ”€â”€ user.py
â”‚   â”‚   â”œâ”€â”€ resume.py
â”‚   â”‚   â””â”€â”€ parsed_resume.py
â”‚   â”‚
â”‚   â”œâ”€â”€ value_objects/           # å€¼å¯¹è±¡ï¼ˆä¸å¯å˜ï¼‰
â”‚   â”‚   â”œâ”€â”€ email.py
â”‚   â”‚   â”œâ”€â”€ phone.py
â”‚   â”‚   â””â”€â”€ verification_code.py
â”‚   â”‚
â”‚   â”œâ”€â”€ repositories/              # é¢†åŸŸä»“åº“æ¥å£
â”‚   â”‚   â”œâ”€â”€ user_repository.py
â”‚   â”‚   â”œâ”€â”€ resume_repository.py
â”‚   â”‚   â””â”€â”€ parsed_resume_repository.py
â”‚   â”‚
â”‚   â”œâ”€â”€ services/                  # é¢†åŸŸæœåŠ¡ï¼ˆä¸šåŠ¡é€»è¾‘ï¼‰
â”‚   â”‚   â”œâ”€â”€ user_service.py
â”‚   â”‚   â”œâ”€â”€ resume_parser_service.py
â”‚   â”‚   â””â”€â”€ verification_service.py
â”‚   â”‚
â”‚   â””â”€â”€ events.py                   # é¢†åŸŸäº‹ä»¶ï¼ˆå¦‚ï¼šResumeParsedEventï¼‰
â”‚
â”œâ”€â”€ application/
â”‚   â”œâ”€â”€ use_cases/                 # åº”ç”¨æœåŠ¡ï¼ˆUse Caseï¼‰
â”‚   â”‚   â”œâ”€â”€ register_user_use_case.py
â”‚   â”‚   â”œâ”€â”€ upload_resume_use_case.py
â”‚   â”‚   â”œâ”€â”€ get_parsed_resume_use_case.py
â”‚   â”‚   â””â”€â”€ verify_email_use_case.py
â”‚   â”‚
â”‚   â””â”€â”€ dtos/                        # æ•°æ®ä¼ è¾“å¯¹è±¡ï¼ˆDTOï¼‰
â”‚       â”œâ”€â”€ user_dto.py
â”‚       â”œâ”€â”€ resume_dto.py
â”‚       â””â”€â”€ parsed_resume_dto.py
â”‚
â”œâ”€â”€ infrastructure/
â”‚   â”œâ”€â”€ database/                    # æ•°æ®åº“è¿æ¥
â”‚   â”‚   â”œâ”€â”€ session.py
â”‚   â”‚   â””â”€â”€ models.py
â”‚   â”‚
â”‚   â”œâ”€â”€ messaging/                   # æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆRabbitMQ/Redisï¼‰
â”‚   |   |__ event_publisher.py       # å‘å¸ƒäº‹ä»¶
â”‚   |   |__ event_handler.py         # å¤„ç†äº‹ä»¶ï¼ˆCelery ä»»åŠ¡ï¼‰
â”‚   |   |__ __init__.py
â”‚   â”‚   â”œâ”€â”€ task_queue.py
â”‚   â”‚   â””â”€â”€ publish_parsed_event.py
â”‚   â”‚
â”‚   â”œâ”€â”€ email/                         # å‘é€é‚®ä»¶éªŒè¯ç 
â”‚   â”‚   â”œâ”€â”€ email_service.py
â”‚   â”‚   â””â”€â”€ templates/
â”‚   â”‚       â””â”€â”€ verification.html
â”‚   â”‚
â”‚   â”œâ”€â”€ file_storage/                # æ–‡ä»¶å­˜å‚¨ï¼ˆæœ¬åœ° / MinIO / S3ï¼‰
â”‚   â”‚   â””â”€â”€ file_service.py
â”‚   â”‚
â”‚   â””â”€â”€ parsers/                       # ç®€å†è§£æå™¨
â”‚       â”œâ”€â”€ pdf_parser.py
â”‚       â”œâ”€â”€ docx_parser.py
â”‚       â””â”€â”€ resume_parser.py
â”‚
â”œâ”€â”€ api/
â”‚   â”œâ”€â”€ routes/
â”‚   â”‚   â”œâ”€â”€ auth.py                # /auth/register, /auth/verify
â”‚   â”‚   â”œâ”€â”€ resume.py              # /resume/upload, /resume/result
â”‚   â”‚   â””â”€â”€ health.py              # /health
â”‚   â”‚
â”‚   â””â”€â”€ dependencies.py            # ä¾èµ–æ³¨å…¥ï¼ˆå¦‚ DB Sessionï¼‰
â”‚
â””â”€â”€ tests/
    â”œâ”€â”€ unit/
    â””â”€â”€ integration/
```

### æ ¸å¿ƒåŠŸèƒ½å®ç°ï¼ˆä»£ç ç‰‡æ®µï¼‰
**ç”¨æˆ·å®ä½“ï¼ˆdomain/entities/user.pyï¼‰**  
```python
from sqlmodel import SQLModel, Field
from typing import Optional
from domain.value_objects.email import Email
from domain.value_objects.verification_code import VerificationCode

class User(SQLModel, table=True):
    id: Optional[int] = Field(default=None, primary_key=True)
    email: str = Field(unique=True)
    is_verified: bool = False
    created_at: datetime = Field(default_factory=datetime.utcnow)
```

**å®šä¹‰é¢†åŸŸäº‹ä»¶ï¼ˆdomain/events.pyï¼‰**  
```python
from typing import Optional
from pydantic import BaseModel
from datetime import datetime

class DomainEvent(BaseModel):
    event_id: str
    occurred_at: datetime
    event_type: str

class UserRegisteredEvent(DomainEvent):
    email: str
    user_id: int
    event_type: str = "UserRegisteredEvent"
```

**é¢†åŸŸæœåŠ¡ä¸­å‘å¸ƒäº‹ä»¶ï¼ˆdomain/services/user_service.pyï¼‰**  
```python
from domain.events import UserRegisteredEvent
from infrastructure.messaging import event_publisher  # æ–°å¢ï¼šäº‹ä»¶å‘å¸ƒå™¨

class UserService:
    def __init__(self, user_repository, verification_service):
        self.user_repository = user_repository
        self.verification_service = verification_service

    async def create_unverified_user(self, email: str) -> User:
        user = User(email=email, is_verified=False)
        return await self.user_repository.save(user)

    async def send_verification_code(self, email: str) -> str:
        code = self.verification_service.generate_code()
        await self.verification_service.send_code(email, code)
        return code

    async def confirm_registration(self, email: str, code: str) -> bool:
        if not await self.verification_service.verify_code(email, code):
            return False

        user = await self.user_repository.find_by_email(email)
        user.is_verified = True
        await self.user_repository.update(user)

        # âœ… å‘å¸ƒé¢†åŸŸäº‹ä»¶ï¼šç”¨æˆ·æ³¨å†ŒæˆåŠŸ
        event = UserRegisteredEvent(
            event_id=str(uuid.uuid4()),
            occurred_at=datetime.utcnow(),
            email=email,
            user_id=user.id
        )
        await event_publisher.publish(event)

        return True
```

**æ³¨å†Œç”¨ä¾‹ï¼ˆapplication/use_cases/register_user_use_case.pyï¼‰**  
```
from domain.services.user_service import UserService
from application.dtos.user_dto import UserDTO
from application.dtos.verification_dto import VerificationDTO

class RegisterUserUseCase:
    def __init__(self, user_service: UserService):
        self.user_service = user_service

    async def execute(self, email: str) -> VerificationDTO:
        user = await self.user_service.create_unverified_user(email)
        code = await self.user_service.send_verification_code(user.email)
        return VerificationDTO(email=email, code=code)
```

**é‚®ä»¶éªŒè¯ç æœåŠ¡ï¼ˆinfrastructure/email/email_service.pyï¼‰**  
```python
import smtplib
from email.mime.text import MIMEText
from email.mime.multipart import MIMEMultipart
from config import settings

class EmailService:
    def send_verification_email(self, email: str, code: str):
        msg = MIMEMultipart()
        msg['From'] = settings.SMTP_SENDER
        msg['To'] = email
        msg['Subject'] = "ã€ç®€å†å¹³å°ã€‘é‚®ç®±éªŒè¯ç "

        body = f"""
        <h2>æ‚¨å¥½ï¼</h2>
        <p>æ‚¨çš„éªŒè¯ç æ˜¯ï¼š<strong>{code}</strong></p>
        <p>è¯·åœ¨5åˆ†é’Ÿå†…å®ŒæˆéªŒè¯ã€‚</p>
        """
        msg.attach(MIMEText(body, 'html'))

        with smtplib.SMTP(settings.SMTP_HOST, settings.SMTP_PORT) as server:
            server.starttls()
            server.login(settings.SMTP_USERNAME, settings.SMTP_PASSWORD)
            server.sendmail(settings.SMTP_SENDER, email, msg.as_string())
```

**ç®€å†ä¸Šä¼ æ¥å£ï¼ˆapi/routes/resume.pyï¼‰**  
```python
from fastapi import APIRouter, UploadFile, File, Depends, HTTPException
from application.use_cases.upload_resume_use_case import UploadResumeUseCase
from application.dtos.resume_dto import ResumeDTO

router = APIRouter()

@router.post("/upload", response_model=ResumeDTO)
async def upload_resume(file: UploadFile = File(...), use_case: UploadResumeUseCase = Depends()):
    try:
        resume_dto = await use_case.execute(file)
        return resume_dto
    except Exception as e:
        raise HTTPException(status_code=400, detail=str(e))
```

**å¼‚æ­¥è§£æç®€å†ï¼ˆinfrastructure/parsers/resume_parser.pyï¼‰**  
```python
import pdfplumber
from docx import Document
from typing import Dict

class ResumeParser:
    def parse(self, file_path: str, file_extension: str) -> Dict:
        if file_extension == ".pdf":
            return self._parse_pdf(file_path)
        elif file_extension == ".docx":
            return self._parse_docx(file_path)
        else:
            raise ValueError("Unsupported file type")

    def _parse_pdf(self, file_path: str) -> Dict:
        with pdfplumber.open(file_path) as pdf:
            text = ""
            for page in pdf.pages:
                text += page.extract_text()
            # ç®€å•å…³é”®è¯æå–ï¼ˆå®é™…åº”ä½¿ç”¨ NLPï¼‰
            return {
                "name": self._extract_name(text),
                "phone": self._extract_phone(text),
                "email": self._extract_email(text),
                "experience": self._extract_experience(text)
            }

    # å…¶ä»–è¾…åŠ©æ–¹æ³•...

# ä½¿ç”¨ celery + redis å¼‚æ­¥æ‰§è¡Œï¼š
# tasks.py
from celery import Celery
from infrastructure.parsers.resume_parser import ResumeParser
from infrastructure.file_storage.file_service import FileService

app = Celery('resume_tasks', broker='redis://localhost:6379/0')

@app.task
def parse_resume_task(file_id: str, file_path: str):
    parser = ResumeParser()
    result = parser.parse(file_path, ".pdf")
    
    # ä¿å­˜åˆ°æ•°æ®åº“
    # ...
    return result
```

**äº‹ä»¶å‘å¸ƒå™¨ï¼ˆinfrastructure/messaging/event_publisher.pyï¼‰**  
```python
from typing import List
from pydantic import BaseModel
import json
import uuid
from celery import Celery

# ä½¿ç”¨ Celery ä½œä¸ºäº‹ä»¶å¹¿æ’­æœºåˆ¶ï¼ˆå¯æ›¿æ¢ä¸º RabbitMQ/Kafkaï¼‰
app = Celery('event_broker', broker='redis://localhost:6379/0')

class EventPublisher:
    async def publish(self, event: BaseModel):
        # åºåˆ—åŒ–äº‹ä»¶
        event_json = event.model_dump_json()
        event_id = str(uuid.uuid4())

        # å¼‚æ­¥å‘å¸ƒåˆ° Celery ä»»åŠ¡é˜Ÿåˆ—
        app.send_task(
            name='handle_domain_event',
            args=[event_id, event_json],
            kwargs={}
        )

event_publisher = EventPublisher()
```

**äº‹ä»¶å¤„ç†å™¨ï¼ˆinfrastructure/messaging/event_handler.pyï¼‰**  
```python
from celery import Celery
from infrastructure.email.email_service import EmailService
from domain.events import UserRegisteredEvent
import json

app = Celery('event_handlers', broker='redis://localhost:6379/0')

@app.task
def handle_domain_event(event_id: str, event_json: str):
    try:
        # ååºåˆ—åŒ–äº‹ä»¶
        data = json.loads(event_json)
        event_type = data.get("event_type")

        if event_type == "UserRegisteredEvent":
            event = UserRegisteredEvent(**data)
            send_welcome_email(event.email, event.user_id)
        else:
            print(f"Unknown event type: {event_type}")
    except Exception as e:
        print(f"Error handling domain event: {e}")

def send_welcome_email(email: str, user_id: int):
    # å‘é€æ¬¢è¿é‚®ä»¶
    email_service = EmailService()
    subject = "ğŸ‰ æ¬¢è¿æ³¨å†Œç®€å†è§£æå¹³å°ï¼"
    body = f"""
    <h2>äº²çˆ±çš„ç”¨æˆ·ï¼Œæ‚¨å¥½ï¼</h2>
    <p>æ‚¨å·²æˆåŠŸæ³¨å†Œç®€å†è§£æå¹³å°ï¼Œè´¦å· IDï¼š{user_id}</p>
    <p>ç°åœ¨å¯ä»¥ä¸Šä¼ ç®€å†ï¼Œå¼€å§‹æ™ºèƒ½è§£æå•¦ï¼</p>
    <p>ç¥æ‚¨ä½¿ç”¨æ„‰å¿«ï¼</p>
    """
    email_service.send_email(email, subject, body)
```

### APIæ¥å£è®¾è®¡ï¼ˆSwagger UI è‡ªåŠ¨å±•ç¤ºï¼‰
```
æ–¹æ³•	è·¯å¾„	åŠŸèƒ½
POST	/auth/register	æ³¨å†Œç”¨æˆ·ï¼ˆé‚®ç®±ï¼‰
POST	/auth/verify	éªŒè¯é‚®ç®±éªŒè¯ç 
POST	/resume/upload	ä¸Šä¼ ç®€å†ï¼ˆæ”¯æŒ PDF/DOCXï¼‰
GET	/resume/result/{resume_id}	è·å–è§£æç»“æœï¼ˆæ”¯æŒè½®è¯¢ï¼‰
```

### æµç¨‹å›¾
ç”¨æˆ·æ³¨å†Œæµç¨‹ï¼š
1. ç”¨æˆ·æäº¤é‚®ç®± â†’ æ³¨å†Œæ¥å£
2. ç”ŸæˆéªŒè¯ç  â†’ å‘é€è‡³é‚®ç®±
3. ç”¨æˆ·è¾“å…¥éªŒè¯ç  â†’ éªŒè¯é€šè¿‡
4. âœ… æ›´æ–°ç”¨æˆ·çŠ¶æ€ä¸ºå·²éªŒè¯
5. âœ… è§¦å‘é¢†åŸŸäº‹ä»¶ï¼šUserRegisteredEvent
6. ğŸ”„ äº‹ä»¶è¢«å¼‚æ­¥æ¶ˆè´¹ï¼šå¤„ç†å‡½æ•° `handle_domain_event`
7. ğŸ”” å¼‚æ­¥å‘é€æ¬¢è¿é‚®ä»¶ï¼ˆæ— éœ€é˜»å¡ä¸»æµç¨‹ï¼‰

### éƒ¨ç½²å»ºè®®
+ å¼€å‘ï¼šæœ¬åœ°è¿è¡Œ FastAPI + PostgreSQL + Redis + RabbitMQ
+ ç”Ÿäº§ï¼š
  - ä½¿ç”¨ Docker Compose ç®¡ç†æœåŠ¡
  - Nginx åå‘ä»£ç† + HTTPS
  - Celery worker é›†ç¾¤å¤„ç†ä»»åŠ¡
  - ä½¿ç”¨ SendGrid æˆ– AWS SES å‘é€é‚®ä»¶

### è¡¥å……ï¼šç¡®ä¿äº‹ä»¶å¤„ç†æœåŠ¡å¯åŠ¨
åœ¨ main.py æˆ–å¯åŠ¨è„šæœ¬ä¸­ï¼Œç¡®ä¿ Celery worker å¯åŠ¨
```python
# å¯åŠ¨ Celery worker ç›‘å¬äº‹ä»¶
celery -A infrastructure.messaging.event_handler app worker -l info
```
### æ€»ç»“
é¡¹ç›®å®Œæ•´å®è·µäº† DDD åˆ†å±‚æ¶æ„ ä¸ FastAPI æ¡†æ¶ çš„ç»“åˆï¼Œå…·å¤‡ï¼š
+ æ¸…æ™°çš„é¢†åŸŸè¾¹ç•Œï¼šåˆ†å±‚æ¸…æ™°ï¼ˆé¢†åŸŸå±‚ã€åº”ç”¨å±‚ã€åŸºç¡€è®¾æ–½å±‚ï¼‰
+ ä¸šåŠ¡é€»è¾‘é›†ä¸­åœ¨é¢†åŸŸå±‚
+ é«˜å†…èšã€ä½è€¦åˆçš„æ¨¡å—è®¾è®¡
  - äº‹ä»¶é©±åŠ¨è§£è€¦ï¼šæ³¨å†Œé€»è¾‘ä¸å‘é‚®ä»¶é€»è¾‘å®Œå…¨åˆ†ç¦»
+ å¼‚æ­¥ä»»åŠ¡å¤„ç†èƒ½åŠ›
  - å¼‚æ­¥æ— é˜»å¡ï¼šç”¨æˆ·æ³¨å†Œå®Œæˆåç«‹åˆ»è¿”å›ï¼Œä¸å½±å“ä½“éªŒ
+ å¯æ‰©å±•ã€æ˜“ç»´æŠ¤çš„ç»“æ„
  - å¯æ‰©å±•æ€§å¼ºï¼šæœªæ¥å¯å¢åŠ â€œå‘é€çŸ­ä¿¡â€ã€â€œé€šçŸ¥ç®¡ç†å‘˜â€ç­‰å¤„ç†é€»è¾‘

# ç›¸å…³èµ„æ–™
+ https://www.cnblogs.com/dennyzhangdd/p/14376904.html
+ https://www.cnblogs.com/davenkin/p/ddd-introduction.html
+ https://blog.csdn.net/fsfjdtpzus/article/details/144009232
+ https://www.cnblogs.com/letjs/articles/18790630
