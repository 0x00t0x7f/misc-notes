# 0x01、写在前
在对现实世界的物质进行信息化表示时，需要先对其进行抽象、再层层递进实现抽象的过程，最终转为数据库中的各种表结构。
这篇文章主要讲解如何设计数据库表。

在进行设计时，一般分为三个阶段
```mermaid
graph TD
    A(概念模型阶段)
    B(逻辑模型阶段)
    C(物理模型阶段)
    A-->B-->C
```

在设计表之前首先要理解需求，可以从以下方面入手
+ 使用一致的命名约定
+ 和需求提出方沟通，明确数据实体以及关系
+ 了解哪些数据是热点数据，频繁查询的字段
+ 预估表的数据量以及之后的增长趋势，后续的扩展计划
+ 确定数据一致性的要求
+ 在设计数据库表前，要遵循数据库的设计范式，在范式化和反范式化之间找到平衡
+ 考虑是否需要分库分表，数据库架构
+ 考虑数据生命周期和归档策略，设计历史数据归档机制
+ 安全性和权限： 遵循最小权限原则、敏感内容加密存储

遵循范式化可以减少数据冗余，有时候根据业务需要和性能要求，也需要适当的反范式化。比如在读取更频繁的场景中，可以释放增加冗余字段，比如在订单表中要关联用户表获取用户订单，可以在订单表中添加用户字段，创建汇总表等等其他手段。

# 0x02、概念模型阶段
识别和梳理业务层面的核心实体、以及实体之间的关系

# 0x03、逻辑模型阶段
更进一步完善实体、实体间的关系、确定实体的属性，具体来说就是
+ 各个实体之间的关系都有哪些约束
+ 各个实体都有哪些业务属性以及属性的业务类型

# 0x04、物理模型阶段
确定之前模型中实体、关系、属性如何映射到具体实现。 具体来说就是
+ 确定业务属性如何转换成数据库表：表、字段、类型
  - 选择合适的数据类型节省存储空间和提升性能
  - 字段类型本着最小最合适原则
  - 固定长度字符串使用char、可变长度使用varchar
  - 存储金额、汇率等对精度要求高的业务，使用 decimal，不要用float
  - 合理使用 enum、set类型限制取值范围
+ 确定实体与实体之间的关系如何转换成数据库的表、主键、外键
  - 主键尽可能简单、除非必要否则避免使用复合主键
  - 主键字段优先采用自增整型，当分布式系统需要生成唯一标识时再考虑使用UUID
  - 避免使用业务字段作为主键，除非该字段真正唯一且不可改变。 比如 如果在用户表中使用电话号码作为主键，这个是唯一的，但可能会改变（用户后续换了电话号码重新绑定时）。
+ 确定数据库表字段的特性，比如： 默认值、是否为空、索引、触发器等
  - 对于频繁查询字段、排序和链接的字段创建索引，同时避免过度索引会增加写操作开销
  - 使用复合索引优化多条件查询
  - 定期分析查询性能，调整索引策略
+ 确定数据库表中除了业务需要外是否需要冗余字段。


